
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Consensus mechanism Â· Simplechain Documentation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-language-picker/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../15_virtualMache/" />
    
    
    <link rel="prev" href="../13_p2pNetwork.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Quick Start</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../1_quickStart.html">
            
                <a href="../1_quickStart.html">
            
                    
                    Quick Start
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../2_BuildNode/">
            
                <a href="../2_BuildNode/">
            
                    
                    Build Node
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Sipc Coin Negotiate</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../47_techniqueLanguage.html">
            
                <a href="../47_techniqueLanguage.html">
            
                    
                    Technical Manual
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../3_sipcCoin.html">
            
                <a href="../3_sipcCoin.html">
            
                    
                    Sipc Coin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../4_PublishCoin/">
            
                <a href="../4_PublishCoin/">
            
                    
                    Publish Coin
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Basic Data Struct</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../5_concoct.html">
            
                <a href="../5_concoct.html">
            
                    
                    Deploy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../6_genesis/">
            
                <a href="../6_genesis/">
            
                    
                    Genesis Block
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../7_account.html">
            
                <a href="../7_account.html">
            
                    
                    Account
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="../8_transaction/">
            
                <a href="../8_transaction/">
            
                    
                    Transaction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="../9_block/">
            
                <a href="../9_block/">
            
                    
                    Block
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="../10_transactionReceipt/">
            
                <a href="../10_transactionReceipt/">
            
                    
                    Transaction Receipt
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Construct</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../11_constructDesign/">
            
                <a href="../11_constructDesign/">
            
                    
                    Structure Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../12_structAndStore/">
            
                <a href="../12_structAndStore/">
            
                    
                    Data Struct and 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../50_togetherStep.html">
            
                <a href="../50_togetherStep.html">
            
                    
                    Data Synchronize
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Underlying Core Technology</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../13_p2pNetwork.html">
            
                <a href="../13_p2pNetwork.html">
            
                    
                    p2p network
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="6.2" data-path="./">
            
                <a href="./">
            
                    
                    Consensus mechanism
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="../15_virtualMache/">
            
                <a href="../15_virtualMache/">
            
                    
                    virtual machine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="../16_runMechanism/">
            
                <a href="../16_runMechanism/">
            
                    
                    Operating mechanism
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="../17_unusual.html">
            
                <a href="../17_unusual.html">
            
                    
                    Handle exceptions
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Smart contract</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../18_contract/">
            
                <a href="../18_contract/">
            
                    
                    Smart contract
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="../19_understandSolidity/">
            
                <a href="../19_understandSolidity/">
            
                    
                    understand Solidity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="../20_contractPattern.html">
            
                <a href="../20_contractPattern.html">
            
                    
                    Contract template
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Developer tools</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../21_buildTest.html">
            
                <a href="../21_buildTest.html">
            
                    
                    Build Test network
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="../22_sipcApi.html">
            
                <a href="../22_sipcApi.html">
            
                    
                    Sip API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="../23_crossChainApi.html">
            
                <a href="../23_crossChainApi.html">
            
                    
                    Cross-chain API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="../24_chromeWallet/">
            
                <a href="../24_chromeWallet/">
            
                    
                    SimPlug
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="../25_sdk/">
            
                <a href="../25_sdk/">
            
                    
                    SDK
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Cross-chain</li>
        
        
    
        <li class="chapter " data-level="9.1" data-path="../48_crossChain/">
            
                <a href="../48_crossChain/">
            
                    
                    Cross-chain solution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="../26_smallChain.html">
            
                <a href="../26_smallChain.html">
            
                    
                    Subchain template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="../49_crossChainOrder/">
            
                <a href="../49_crossChainOrder/">
            
                    
                    Cross-chain process
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Dapp develop</li>
        
        
    
        <li class="chapter " data-level="10.1" data-path="../27_dappFlow/">
            
                <a href="../27_dappFlow/">
            
                    
                    Dapp process carding
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.2" data-path="../28_editor.html">
            
                <a href="../28_editor.html">
            
                    
                    translater
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.3" data-path="../29_writeContract/">
            
                <a href="../29_writeContract/">
            
                    
                    Write contract
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.4" data-path="../30_frontRealize/">
            
                <a href="../30_frontRealize/">
            
                    
                    Front-end development
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Mining</li>
        
        
    
        <li class="chapter " data-level="11.1" data-path="../31_mining.html">
            
                <a href="../31_mining.html">
            
                    
                    sipc mining
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.2" data-path="../32_miningPool/">
            
                <a href="../32_miningPool/">
            
                    
                    MinePool access
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.3" data-path="../33_gpuMining/">
            
                <a href="../33_gpuMining/">
            
                    
                    GPU Mining
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.4" data-path="../34_SimPool/">
            
                <a href="../34_SimPool/">
            
                    
                    Simpool Mining
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.5" data-path="../35_SimpleNode_x1/">
            
                <a href="../35_SimpleNode_x1/">
            
                    
                    SimpleNode x1 Mining
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Client</li>
        
        
    
        <li class="chapter " data-level="12.1" data-path="../36_SIPC.html">
            
                <a href="../36_SIPC.html">
            
                    
                    SIPC.VIP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.2" data-path="../37_wallet/">
            
                <a href="../37_wallet/">
            
                    
                    Sipc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.3" data-path="../38_ChainBox/">
            
                <a href="../38_ChainBox/">
            
                    
                    ChainBox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.4" data-path="../39_blockBrowser/">
            
                <a href="../39_blockBrowser/">
            
                    
                    Explore
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Ecology</li>
        
        
    
        <li class="chapter " data-level="13.1" data-path="../40_tradePlateform.html">
            
                <a href="../40_tradePlateform.html">
            
                    
                    Exchange docking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="13.2" data-path="../41_commityProduct.html">
            
                <a href="../41_commityProduct.html">
            
                    
                    Community Project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="13.3" data-path="../42_commityActity.html">
            
                <a href="../42_commityActity.html">
            
                    
                    Community Activity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="13.4" data-path="../43_commityEnters/">
            
                <a href="../43_commityEnters/">
            
                    
                    Community Entrance
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Landing scheme</li>
        
        
    
        <li class="chapter " data-level="14.1" data-path="../44_case.html">
            
                <a href="../44_case.html">
            
                    
                    Landing case
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Other</li>
        
        
    
        <li class="chapter " data-level="15.1" data-path="../45_faq.html">
            
                <a href="../45_faq.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="15.2" data-path="../46_supportOnline/">
            
                <a href="../46_supportOnline/">
            
                    
                    Online technical support
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Consensus mechanism</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>Consensus mechanism is an algorithm for distributed consensus of blockchain transactions. Due to high or low network latency in a point-to-point network, the order of transactions received by each node may be different, therefore, the blockchain system needs to design a mechanism to enable nodes to reach a consensus on the order of transactions that occur at about the same time. This is the consensus mechanism.</p>
<h2 id="pow-consensus-algorithm"><a name="pow-consensus-algorithm" class="plugin-anchor" href="#pow-consensus-algorithm"><i class="fa fa-link" aria-hidden="true"></i></a>PoW consensus algorithm</h2>
<p>PoW proves that you have completed the characteristics of the corresponding work hash function through the work results:</p>
<ol>
<li>Collision-free, that is, there is no case where the input values are different and the hash values are the same after hash transformation.</li>
<li>Concealment, that is, given a hash value, it is infeasible to reverse the input value.</li>
<li>There is no better method than exhaustive to make hash values fall within a specific range. POW algorithm principle: the node searches for the appropriate hash value by  constantly changing random numbers. When the node first calculates the appropriate hash value, if the packaged block passes the verification of other consensus nodes, it is added to the blockchain.</li>
</ol>
<h3 id="introduction-to-scrypt-algorithm"><a name="introduction-to-scrypt-algorithm" class="plugin-anchor" href="#introduction-to-scrypt-algorithm"><i class="fa fa-link" aria-hidden="true"></i></a>Introduction to Scrypt algorithm</h3>
<p>The mining algorithm adopted by Simplechain is Scrypt algorithm. Scrypt is a memory-dependent POW algorithm that conforms to the PoW consensus mechanism. The Scrypt algorithm also needs to calculate the hash value, but more memory resources are needed in the Scrypt calculation process.</p>
<h3 id="scrypt-algorithm-process"><a name="scrypt-algorithm-process" class="plugin-anchor" href="#scrypt-algorithm-process"><i class="fa fa-link" aria-hidden="true"></i></a>Scrypt algorithm process</h3>
<p>Several functions used by the Scrypt algorithm are interlocking. This section describes the calling order of the functions from inside to outside.</p>
<h3 id="salsa208"><a name="salsa208" class="plugin-anchor" href="#salsa208"><i class="fa fa-link" aria-hidden="true"></i></a>Salsa20/8</h3>
<pre><code class="lang-c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> R(a,b) (((a) &lt;&lt; (b)) | ((a) &gt;&gt; (32 - (b))))</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">salsa20_word_specification</span><span class="hljs-params">(uint32 out[<span class="hljs-number">16</span>],uint32 in[<span class="hljs-number">16</span>])</span>
</span>{
    <span class="hljs-keyword">int</span> i;
    uint32 x[<span class="hljs-number">16</span>];
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>;i &lt; <span class="hljs-number">16</span>;++i) x[i] = in[i];
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">8</span>;i &gt; <span class="hljs-number">0</span>;i -= <span class="hljs-number">2</span>) {
        x[ <span class="hljs-number">4</span>] ^= R(x[ <span class="hljs-number">0</span>]+x[<span class="hljs-number">12</span>], <span class="hljs-number">7</span>); x[ <span class="hljs-number">8</span>] ^= R(x[ <span class="hljs-number">4</span>]+x[ <span class="hljs-number">0</span>], <span class="hljs-number">9</span>);
        x[<span class="hljs-number">12</span>] ^= R(x[ <span class="hljs-number">8</span>]+x[ <span class="hljs-number">4</span>],<span class="hljs-number">13</span>); x[ <span class="hljs-number">0</span>] ^= R(x[<span class="hljs-number">12</span>]+x[ <span class="hljs-number">8</span>],<span class="hljs-number">18</span>);
        x[ <span class="hljs-number">9</span>] ^= R(x[ <span class="hljs-number">5</span>]+x[ <span class="hljs-number">1</span>], <span class="hljs-number">7</span>); x[<span class="hljs-number">13</span>] ^= R(x[ <span class="hljs-number">9</span>]+x[ <span class="hljs-number">5</span>], <span class="hljs-number">9</span>);
        x[ <span class="hljs-number">1</span>] ^= R(x[<span class="hljs-number">13</span>]+x[ <span class="hljs-number">9</span>],<span class="hljs-number">13</span>); x[ <span class="hljs-number">5</span>] ^= R(x[ <span class="hljs-number">1</span>]+x[<span class="hljs-number">13</span>],<span class="hljs-number">18</span>);
        x[<span class="hljs-number">14</span>] ^= R(x[<span class="hljs-number">10</span>]+x[ <span class="hljs-number">6</span>], <span class="hljs-number">7</span>); x[ <span class="hljs-number">2</span>] ^= R(x[<span class="hljs-number">14</span>]+x[<span class="hljs-number">10</span>], <span class="hljs-number">9</span>);
        x[ <span class="hljs-number">6</span>] ^= R(x[ <span class="hljs-number">2</span>]+x[<span class="hljs-number">14</span>],<span class="hljs-number">13</span>); x[<span class="hljs-number">10</span>] ^= R(x[ <span class="hljs-number">6</span>]+x[ <span class="hljs-number">2</span>],<span class="hljs-number">18</span>);
        x[ <span class="hljs-number">3</span>] ^= R(x[<span class="hljs-number">15</span>]+x[<span class="hljs-number">11</span>], <span class="hljs-number">7</span>); x[ <span class="hljs-number">7</span>] ^= R(x[ <span class="hljs-number">3</span>]+x[<span class="hljs-number">15</span>], <span class="hljs-number">9</span>);
        x[<span class="hljs-number">11</span>] ^= R(x[ <span class="hljs-number">7</span>]+x[ <span class="hljs-number">3</span>],<span class="hljs-number">13</span>); x[<span class="hljs-number">15</span>] ^= R(x[<span class="hljs-number">11</span>]+x[ <span class="hljs-number">7</span>],<span class="hljs-number">18</span>);
        x[ <span class="hljs-number">1</span>] ^= R(x[ <span class="hljs-number">0</span>]+x[ <span class="hljs-number">3</span>], <span class="hljs-number">7</span>); x[ <span class="hljs-number">2</span>] ^= R(x[ <span class="hljs-number">1</span>]+x[ <span class="hljs-number">0</span>], <span class="hljs-number">9</span>);
        x[ <span class="hljs-number">3</span>] ^= R(x[ <span class="hljs-number">2</span>]+x[ <span class="hljs-number">1</span>],<span class="hljs-number">13</span>); x[ <span class="hljs-number">0</span>] ^= R(x[ <span class="hljs-number">3</span>]+x[ <span class="hljs-number">2</span>],<span class="hljs-number">18</span>);
        x[ <span class="hljs-number">6</span>] ^= R(x[ <span class="hljs-number">5</span>]+x[ <span class="hljs-number">4</span>], <span class="hljs-number">7</span>); x[ <span class="hljs-number">7</span>] ^= R(x[ <span class="hljs-number">6</span>]+x[ <span class="hljs-number">5</span>], <span class="hljs-number">9</span>);
        x[ <span class="hljs-number">4</span>] ^= R(x[ <span class="hljs-number">7</span>]+x[ <span class="hljs-number">6</span>],<span class="hljs-number">13</span>); x[ <span class="hljs-number">5</span>] ^= R(x[ <span class="hljs-number">4</span>]+x[ <span class="hljs-number">7</span>],<span class="hljs-number">18</span>);
        x[<span class="hljs-number">11</span>] ^= R(x[<span class="hljs-number">10</span>]+x[ <span class="hljs-number">9</span>], <span class="hljs-number">7</span>); x[ <span class="hljs-number">8</span>] ^= R(x[<span class="hljs-number">11</span>]+x[<span class="hljs-number">10</span>], <span class="hljs-number">9</span>);
        x[ <span class="hljs-number">9</span>] ^= R(x[ <span class="hljs-number">8</span>]+x[<span class="hljs-number">11</span>],<span class="hljs-number">13</span>); x[<span class="hljs-number">10</span>] ^= R(x[ <span class="hljs-number">9</span>]+x[ <span class="hljs-number">8</span>],<span class="hljs-number">18</span>);
        x[<span class="hljs-number">12</span>] ^= R(x[<span class="hljs-number">15</span>]+x[<span class="hljs-number">14</span>], <span class="hljs-number">7</span>); x[<span class="hljs-number">13</span>] ^= R(x[<span class="hljs-number">12</span>]+x[<span class="hljs-number">15</span>], <span class="hljs-number">9</span>);
        x[<span class="hljs-number">14</span>] ^= R(x[<span class="hljs-number">13</span>]+x[<span class="hljs-number">12</span>],<span class="hljs-number">13</span>); x[<span class="hljs-number">15</span>] ^= R(x[<span class="hljs-number">14</span>]+x[<span class="hljs-number">13</span>],<span class="hljs-number">18</span>);
    }
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>;i &lt; <span class="hljs-number">16</span>;++i) out[i] = x[i] + in[i];
}
</code></pre>
<h3 id="scryptblockmix"><a name="scryptblockmix" class="plugin-anchor" href="#scryptblockmix"><i class="fa fa-link" aria-hidden="true"></i></a>scryptBlockMix</h3>
<pre><code class="lang-c++"> Parameters:
            r Block size parameter.
   Input:
            B[0] || B[1] || ... || B[2 * r - 1]
                   Input octet string (of size 128 * r octets),
                   treated as 2 * r 64-octet blocks,
                   where each element in B is a 64-octet block.
   Output:
            B&apos;[0] || B&apos;[1] || ... || B&apos;[2 * r - 1]
                   Output octet string.
   Steps:
     1. X = B[2 * r - 1]
     2. for i = 0 to 2 * r - 1 do
          T = X xor B[i]
          X = Salsa (T)
          Y[i] = X
        end for
     3. B&apos; = (Y[0], Y[2], ..., Y[2 * r - 2],
              Y[1], Y[3], ..., Y[2 * r - 1])
</code></pre>
<h3 id="scryptromix"><a name="scryptromix" class="plugin-anchor" href="#scryptromix"><i class="fa fa-link" aria-hidden="true"></i></a>scryptROMix</h3>
<pre><code class="lang-c++"> Input:
            r Block size parameter.
            B Input octet vector of length 128 * r octets.
            N CPU/Memory cost parameter, must be larger than 1,
                    a power of 2, and less than 2^(128 * r / 8).
   Output:
            B&apos; Output octet vector of length 128 * r octets.
   Steps:
     1. X = B
     2. for i = 0 to N - 1 do
          V[i] = X
          X = scryptBlockMix (X)
        end for
     3. for i = 0 to N - 1 do
          j = Integerify (X) mod N
                 where Integerify (B[0] ... B[2 * r - 1]) is defined
                 as the result of interpreting B[2 * r - 1] as a
                 little-endian integer.
          T = X xor V[j]
          X = scryptBlockMix (T)
        end for
     4. B&apos; = X
</code></pre>
<h3 id="scrypt"><a name="scrypt" class="plugin-anchor" href="#scrypt"><i class="fa fa-link" aria-hidden="true"></i></a>scrypt</h3>
<pre><code class="lang-c++">Input:
            P Passphrase, an octet string.
            S Salt, an octet string.
            N CPU/Memory cost parameter, must be larger than 1,
                    a power of 2, and less than 2^(128 * r / 8).
            r Block size parameter.
            p Parallelization parameter, a positive integer
                    less than or equal to ((2^32-1) * hLen) / MFLen
                    where hLen is 32 and MFlen is 128 * r.
            dkLen Intended output length in octets of the derived
                    key; a positive integer less than or equal to
                    (2^32 - 1) * hLen where hLen is 32.
   Output:
            DK Derived key, of length dkLen octets.
   Steps:
    1. Initialize an array B consisting of p blocks of 128 * r octets
       each:
        B[0] || B[1] || ... || B[p - 1] =
          PBKDF2-HMAC-SHA256 (P, S, 1, p * 128 * r)
    2. for i = 0 to p - 1 do
          B[i] = scryptROMix (r, B[i], N)
        end for
    3. DK = PBKDF2-HMAC-SHA256 (P, B[0] || B[1] || ... || B[p - 1], 
                                        1, dkLen)
</code></pre>
<p>In the mining algorithm, the selected parameters are:</p>
<ul>
<li>P&#xFF1A;block header;</li>
<li>S&#xFF1A;block header;</li>
<li>N&#xFF1A;fixed as 1024;</li>
<li>r&#xFF1A;fixed as 1;</li>
<li>p&#xFF1A;fixed as 1;</li>
<li>dkLen&#xFF1A;fixed to 32, that is, the output length is 32 bytes.</li>
</ul>
<p>Therefore, the hash value of the block header of the Wright coin is powhash = scrypt(blockheader, blockheader, 1024, 1, 1, 32). You can refer to the Go language version for obtaining the block header hash in Wright coin.</p>
<pre><code class="lang-go"><span class="hljs-comment">// Copyright (c) 2013-2016 The btcsuite developers</span>
<span class="hljs-comment">// Use of this source code is governed by an ISC</span>
<span class="hljs-comment">// license that can be found in the LICENSE file.</span>

<span class="hljs-keyword">package</span> wire

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;bytes&quot;</span>
    <span class="hljs-string">&quot;io&quot;</span>
    <span class="hljs-string">&quot;time&quot;</span>

    <span class="hljs-string">&quot;golang.org/x/crypto/scrypt&quot;</span>

    <span class="hljs-string">&quot;github.com/ltcsuite/ltcd/chaincfg/chainhash&quot;</span>
)

<span class="hljs-comment">// MaxBlockHeaderPayload is the maximum number of bytes a block header can be.</span>
<span class="hljs-comment">// Version 4 bytes + Timestamp 4 bytes + Bits 4 bytes + Nonce 4 bytes +</span>
<span class="hljs-comment">// PrevBlock and MerkleRoot hashes.</span>
<span class="hljs-keyword">const</span> MaxBlockHeaderPayload = <span class="hljs-number">16</span> + (chainhash.HashSize * <span class="hljs-number">2</span>)

<span class="hljs-comment">// BlockHeader defines information about a block and is used in the bitcoin</span>
<span class="hljs-comment">// block (MsgBlock) and headers (MsgHeaders) messages.</span>
<span class="hljs-keyword">type</span> BlockHeader <span class="hljs-keyword">struct</span> {
    <span class="hljs-comment">// Version of the block.  This is not the same as the protocol version.</span>
    Version <span class="hljs-keyword">int32</span>

    <span class="hljs-comment">// Hash of the previous block header in the block chain.</span>
    PrevBlock chainhash.Hash

    <span class="hljs-comment">// Merkle tree reference to hash of all transactions for the block.</span>
    MerkleRoot chainhash.Hash

    <span class="hljs-comment">// Time the block was created.  This is, unfortunately, encoded as a</span>
    <span class="hljs-comment">// uint32 on the wire and therefore is limited to 2106.</span>
    Timestamp time.Time

    <span class="hljs-comment">// Difficulty target for the block.</span>
    Bits <span class="hljs-keyword">uint32</span>

    <span class="hljs-comment">// Nonce used to generate the block.</span>
    Nonce <span class="hljs-keyword">uint32</span>
}

<span class="hljs-comment">// blockHeaderLen is a constant that represents the number of bytes for a block</span>
<span class="hljs-comment">// header.</span>
<span class="hljs-keyword">const</span> blockHeaderLen = <span class="hljs-number">80</span>

<span class="hljs-comment">// BlockHash computes the block identifier hash for the given block header.</span>
<span class="hljs-keyword">func</span> (h *BlockHeader) BlockHash() chainhash.Hash {
    <span class="hljs-comment">// Encode the header and double sha256 everything prior to the number of</span>
    <span class="hljs-comment">// transactions.  Ignore the error returns since there is no way the</span>
    <span class="hljs-comment">// encode could fail except being out of memory which would cause a</span>
    <span class="hljs-comment">// run-time panic.</span>
    buf := bytes.NewBuffer(<span class="hljs-built_in">make</span>([]<span class="hljs-keyword">byte</span>, <span class="hljs-number">0</span>, MaxBlockHeaderPayload))
    _ = writeBlockHeader(buf, <span class="hljs-number">0</span>, h)

    <span class="hljs-keyword">return</span> chainhash.DoubleHashH(buf.Bytes())
}

<span class="hljs-comment">// PowHash returns the litecoin scrypt hash of this block header. This value is</span>
<span class="hljs-comment">// used to check the PoW on blocks advertised on the network.</span>
<span class="hljs-keyword">func</span> (h *BlockHeader) PowHash() (*chainhash.Hash, error) {
    <span class="hljs-keyword">var</span> powHash chainhash.Hash

    buf := bytes.NewBuffer(<span class="hljs-built_in">make</span>([]<span class="hljs-keyword">byte</span>, <span class="hljs-number">0</span>, MaxBlockHeaderPayload))
    _ = writeBlockHeader(buf, <span class="hljs-number">0</span>, h)

    scryptHash, err := scrypt.Key(buf.Bytes(), buf.Bytes(), <span class="hljs-number">1024</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">32</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    <span class="hljs-built_in">copy</span>(powHash[:], scryptHash)

    <span class="hljs-keyword">return</span> &amp;powHash, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// BtcDecode decodes r using the bitcoin protocol encoding into the receiver.</span>
<span class="hljs-comment">// This is part of the Message interface implementation.</span>
<span class="hljs-comment">// See Deserialize for decoding block headers stored to disk, such as in a</span>
<span class="hljs-comment">// database, as opposed to decoding block headers from the wire.</span>
<span class="hljs-keyword">func</span> (h *BlockHeader) BtcDecode(r io.Reader, pver <span class="hljs-keyword">uint32</span>, enc MessageEncoding) error {
    <span class="hljs-keyword">return</span> readBlockHeader(r, pver, h)
}

<span class="hljs-comment">// BtcEncode encodes the receiver to w using the bitcoin protocol encoding.</span>
<span class="hljs-comment">// This is part of the Message interface implementation.</span>
<span class="hljs-comment">// See Serialize for encoding block headers to be stored to disk, such as in a</span>
<span class="hljs-comment">// database, as opposed to encoding block headers for the wire.</span>
<span class="hljs-keyword">func</span> (h *BlockHeader) BtcEncode(w io.Writer, pver <span class="hljs-keyword">uint32</span>, enc MessageEncoding) error {
    <span class="hljs-keyword">return</span> writeBlockHeader(w, pver, h)
}

<span class="hljs-comment">// Deserialize decodes a block header from r into the receiver using a format</span>
<span class="hljs-comment">// that is suitable for long-term storage such as a database while respecting</span>
<span class="hljs-comment">// the Version field.</span>
<span class="hljs-keyword">func</span> (h *BlockHeader) Deserialize(r io.Reader) error {
    <span class="hljs-comment">// At the current time, there is no difference between the wire encoding</span>
    <span class="hljs-comment">// at protocol version 0 and the stable long-term storage format.  As</span>
    <span class="hljs-comment">// a result, make use of readBlockHeader.</span>
    <span class="hljs-keyword">return</span> readBlockHeader(r, <span class="hljs-number">0</span>, h)
}

<span class="hljs-comment">// Serialize encodes a block header from r into the receiver using a format</span>
<span class="hljs-comment">// that is suitable for long-term storage such as a database while respecting</span>
<span class="hljs-comment">// the Version field.</span>
<span class="hljs-keyword">func</span> (h *BlockHeader) Serialize(w io.Writer) error {
    <span class="hljs-comment">// At the current time, there is no difference between the wire encoding</span>
    <span class="hljs-comment">// at protocol version 0 and the stable long-term storage format.  As</span>
    <span class="hljs-comment">// a result, make use of writeBlockHeader.</span>
    <span class="hljs-keyword">return</span> writeBlockHeader(w, <span class="hljs-number">0</span>, h)
}

<span class="hljs-comment">// NewBlockHeader returns a new BlockHeader using the provided version, previous</span>
<span class="hljs-comment">// block hash, merkle root hash, difficulty bits, and nonce used to generate the</span>
<span class="hljs-comment">// block with defaults for the remaining fields.</span>
<span class="hljs-keyword">func</span> NewBlockHeader(version <span class="hljs-keyword">int32</span>, prevHash, merkleRootHash *chainhash.Hash,
    bits <span class="hljs-keyword">uint32</span>, nonce <span class="hljs-keyword">uint32</span>) *BlockHeader {

    <span class="hljs-comment">// Limit the timestamp to one second precision since the protocol</span>
    <span class="hljs-comment">// doesn&apos;t support better.</span>
    <span class="hljs-keyword">return</span> &amp;BlockHeader{
        Version:    version,
        PrevBlock:  *prevHash,
        MerkleRoot: *merkleRootHash,
        Timestamp:  time.Unix(time.Now().Unix(), <span class="hljs-number">0</span>),
        Bits:       bits,
        Nonce:      nonce,
    }
}

<span class="hljs-comment">// readBlockHeader reads a bitcoin block header from r.  See Deserialize for</span>
<span class="hljs-comment">// decoding block headers stored to disk, such as in a database, as opposed to</span>
<span class="hljs-comment">// decoding from the wire.</span>
<span class="hljs-keyword">func</span> readBlockHeader(r io.Reader, pver <span class="hljs-keyword">uint32</span>, bh *BlockHeader) error {
    <span class="hljs-keyword">return</span> readElements(r, &amp;bh.Version, &amp;bh.PrevBlock, &amp;bh.MerkleRoot,
        (*uint32Time)(&amp;bh.Timestamp), &amp;bh.Bits, &amp;bh.Nonce)
}

<span class="hljs-comment">// writeBlockHeader writes a bitcoin block header to w.  See Serialize for</span>
<span class="hljs-comment">// encoding block headers to be stored to disk, such as in a database, as</span>
<span class="hljs-comment">// opposed to encoding for the wire.</span>
<span class="hljs-keyword">func</span> writeBlockHeader(w io.Writer, pver <span class="hljs-keyword">uint32</span>, bh *BlockHeader) error {
    sec := <span class="hljs-keyword">uint32</span>(bh.Timestamp.Unix())
    <span class="hljs-keyword">return</span> writeElements(w, bh.Version, &amp;bh.PrevBlock, &amp;bh.MerkleRoot,
        sec, bh.Bits, bh.Nonce)
}
</code></pre>
<h2 id="poa-consensus-algorithm"><a name="poa-consensus-algorithm" class="plugin-anchor" href="#poa-consensus-algorithm"><i class="fa fa-link" aria-hidden="true"></i></a>POA consensus algorithm</h2>
<h3 id="background-of-poa-generation"><a name="background-of-poa-generation" class="plugin-anchor" href="#background-of-poa-generation"><i class="fa fa-link" aria-hidden="true"></i></a>Background of POA generation</h3>
<p>If you want to use Simplechain to build a private chain with lower transaction costs, lower transaction latency, and higher concurrency, also have full control (meaning lower probability of being attacked). Currently, Simplechain cannot meet the requirements by using PoW.</p>
<ul>
<li><p>First of all, pow has a 51% attack problem. Malicious miners who exceed 51% of the total network computing power can basically fully control the entire network. Because the chain cannot be changed, the data that has been linked cannot be changed, but malicious miners can also do some DoS attacks to prevent legitimate transactions from being linked, considering that absenteeism with the same creation block can join your network, potential security risks will exist for a long time.</p>
</li>
<li><p>Secondly, a large amount of PoW power resource consumption also needs to be considered as follow-up cost. PoS can solve some Pow problems, such as saving power and protecting 51% of attacks to a certain extent (malicious absenteeism will be punished), but there are still deficiencies in control and security considerations, because PoS still allows any eligible absenteeism to join.</p>
</li>
</ul>
<h3 id="features-of-poa"><a name="features-of-poa" class="plugin-anchor" href="#features-of-poa"><i class="fa fa-link" aria-hidden="true"></i></a>Features of POA</h3>
<ul>
<li>PoA relies on the default authorized nodes (signers) to generate blocks.</li>
<li>A new signer can be elected by an authorized signer (voting more than 50%) to join the new signer.</li>
<li>Even if a malicious signer exists, it can only attack one of the consecutive blocks (the number is (SIGNER_COUNT / 2) +1). During this period, other signers can vote to kick the malicious signer.</li>
<li>You can specify the time when the block is generated.</li>
</ul>
<h3 id="the-workflow-of-poa-is-as-follows"><a name="the-workflow-of-poa-is-as-follows" class="plugin-anchor" href="#the-workflow-of-poa-is-as-follows"><i class="fa fa-link" aria-hidden="true"></i></a>The workflow of POA is as follows</h3>
<ol>
<li>Specify a group of initially authorized signers in the creation block. All addresses are stored in the Extra field of the creation block.</li>
<li>After mining is started, the group of signers begin to sign and broadcast the generated block.</li>
<li>The signature results are saved in the Extra field of the block header.</li>
<li>Update the addresses of all currently highly authorized signers in Extra because there are new signers added or kicked out</li>
<li>Each height has a signer IN the IN-TURN State and other signers IN the OUT-OF-TURN state. The block signed by the signer IN-TURN will be broadcast immediately, the OUT-OF-TURN signer-signed block will be broadcast after a little random time delay to ensure that the IN-TURN signature block has a higher priority.</li>
<li>If a new signer needs to be added, the signer initiates a proposal through the API interface, which uses the block header Coinbase (new signer address) and Nonce(&quot;0xffffffffffff&quot;) fields are broadcast to other nodes. All authorized signers vote for the new signer. If the affirmative vote exceeds 50% of the total number of signers, they agree to join</li>
<li>If an old signer needs to be kicked out, all authorized signers will &quot;kick out&quot; the old signer. If the affirmative vote exceeds 50% of the total number of signers, it means they agree to kick out.</li>
</ol>
<h3 id="how-to-select-poa-consensus-algorithm-in-simplechain"><a name="how-to-select-poa-consensus-algorithm-in-simplechain" class="plugin-anchor" href="#how-to-select-poa-consensus-algorithm-in-simplechain"><i class="fa fa-link" aria-hidden="true"></i></a>How to Select POA consensus algorithm in Simplechain</h3>
<p>Download and generate a new genesis block file, <a href="https://github.com/huangxinglong/picture/raw/master/puppeth" target="_blank">Download Address</a></p>
<p>After the download is complete, run the command <code>Generate genesis block</code> In the process of generating the creation block file, you can choose the consensus algorithm you want. As shown below:</p>
<p><img src="1.png" alt="W4f.png"></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../13_p2pNetwork.html" class="navigation navigation-prev " aria-label="Previous page: p2p network">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../15_virtualMache/" class="navigation navigation-next " aria-label="Next page: virtual machine">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Consensus mechanism","level":"6.2","depth":1,"next":{"title":"virtual machine","level":"6.3","depth":1,"path":"15_virtualMache/README.md","ref":"15_virtualMache/README.md","articles":[]},"previous":{"title":"p2p network","level":"6.1","depth":1,"path":"13_p2pNetwork.md","ref":"13_p2pNetwork.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-lunr","-search","search-pro","language-picker","anchors"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"search-pro":{},"language-picker":{"grid-columns":3},"anchors":{},"livereload":{},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Simplechain Documentation","language":"en","gitbook":"*"},"file":{"path":"14_consensus/README.md","mtime":"2020-07-02T02:55:16.180Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-07-02T06:02:09.980Z"},"basePath":"..","book":{"language":"en"}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-language-picker/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

