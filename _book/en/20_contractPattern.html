
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Contract template Â· Simplechain Documentation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-language-picker/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="21_buildTest.html" />
    
    
    <link rel="prev" href="19_understandSolidity/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Quick Start</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="1_quickStart.html">
            
                <a href="1_quickStart.html">
            
                    
                    Quick Start
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="2_BuildNode/">
            
                <a href="2_BuildNode/">
            
                    
                    Build Node
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Sipc Coin Negotiate</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="47_techniqueLanguage.html">
            
                <a href="47_techniqueLanguage.html">
            
                    
                    Technical Manual
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="3_sipcCoin.html">
            
                <a href="3_sipcCoin.html">
            
                    
                    Sipc Coin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="4_PublishCoin/">
            
                <a href="4_PublishCoin/">
            
                    
                    Publish Coin
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Basic Data Struct</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="5_concoct.html">
            
                <a href="5_concoct.html">
            
                    
                    Deploy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="6_genesis/">
            
                <a href="6_genesis/">
            
                    
                    Genesis Block
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="7_account.html">
            
                <a href="7_account.html">
            
                    
                    Account
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="8_transaction/">
            
                <a href="8_transaction/">
            
                    
                    Transaction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="9_block/">
            
                <a href="9_block/">
            
                    
                    Block
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="10_transactionReceipt/">
            
                <a href="10_transactionReceipt/">
            
                    
                    Transaction Receipt
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Construct</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="11_constructDesign/">
            
                <a href="11_constructDesign/">
            
                    
                    Structure Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="12_structAndStore/">
            
                <a href="12_structAndStore/">
            
                    
                    Data Struct and 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="50_togetherStep.html">
            
                <a href="50_togetherStep.html">
            
                    
                    Data Synchronize
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Underlying Core Technology</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="13_p2pNetwork.html">
            
                <a href="13_p2pNetwork.html">
            
                    
                    p2p network
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="14_consensus/">
            
                <a href="14_consensus/">
            
                    
                    Consensus mechanism
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="15_virtualMache/">
            
                <a href="15_virtualMache/">
            
                    
                    virtual machine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="16_runMechanism/">
            
                <a href="16_runMechanism/">
            
                    
                    Operating mechanism
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="17_unusual.html">
            
                <a href="17_unusual.html">
            
                    
                    Handle exceptions
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Smart contract</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="18_contract/">
            
                <a href="18_contract/">
            
                    
                    Smart contract
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="19_understandSolidity/">
            
                <a href="19_understandSolidity/">
            
                    
                    understand Solidity
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="7.3" data-path="20_contractPattern.html">
            
                <a href="20_contractPattern.html">
            
                    
                    Contract template
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Developer tools</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="21_buildTest.html">
            
                <a href="21_buildTest.html">
            
                    
                    Build Test network
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="22_sipcApi.html">
            
                <a href="22_sipcApi.html">
            
                    
                    Sip API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="23_crossChainApi.html">
            
                <a href="23_crossChainApi.html">
            
                    
                    Cross-chain API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="24_chromeWallet/">
            
                <a href="24_chromeWallet/">
            
                    
                    SimPlug
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="25_sdk/">
            
                <a href="25_sdk/">
            
                    
                    SDK
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Cross-chain</li>
        
        
    
        <li class="chapter " data-level="9.1" data-path="48_crossChain/">
            
                <a href="48_crossChain/">
            
                    
                    Cross-chain solution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="26_smallChain.html">
            
                <a href="26_smallChain.html">
            
                    
                    Subchain template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="49_crossChainOrder/">
            
                <a href="49_crossChainOrder/">
            
                    
                    Cross-chain process
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Dapp develop</li>
        
        
    
        <li class="chapter " data-level="10.1" data-path="27_dappFlow/">
            
                <a href="27_dappFlow/">
            
                    
                    Dapp process carding
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.2" data-path="28_editor.html">
            
                <a href="28_editor.html">
            
                    
                    translater
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.3" data-path="29_writeContract/">
            
                <a href="29_writeContract/">
            
                    
                    Write contract
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.4" data-path="30_frontRealize/">
            
                <a href="30_frontRealize/">
            
                    
                    Front-end development
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Mining</li>
        
        
    
        <li class="chapter " data-level="11.1" data-path="31_mining.html">
            
                <a href="31_mining.html">
            
                    
                    sipc mining
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.2" data-path="32_miningPool/">
            
                <a href="32_miningPool/">
            
                    
                    MinePool access
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.3" data-path="33_gpuMining/">
            
                <a href="33_gpuMining/">
            
                    
                    GPU Mining
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.4" data-path="34_SimPool/">
            
                <a href="34_SimPool/">
            
                    
                    Simpool Mining
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.5" data-path="35_SimpleNode_x1/">
            
                <a href="35_SimpleNode_x1/">
            
                    
                    SimpleNode x1 Mining
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Client</li>
        
        
    
        <li class="chapter " data-level="12.1" data-path="36_SIPC.html">
            
                <a href="36_SIPC.html">
            
                    
                    SIPC.VIP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.2" data-path="37_wallet/">
            
                <a href="37_wallet/">
            
                    
                    Sipc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.3" data-path="38_ChainBox/">
            
                <a href="38_ChainBox/">
            
                    
                    ChainBox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.4" data-path="39_blockBrowser/">
            
                <a href="39_blockBrowser/">
            
                    
                    Explore
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Ecology</li>
        
        
    
        <li class="chapter " data-level="13.1" data-path="40_tradePlateform.html">
            
                <a href="40_tradePlateform.html">
            
                    
                    Exchange docking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="13.2" data-path="41_commityProduct.html">
            
                <a href="41_commityProduct.html">
            
                    
                    Community Project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="13.3" data-path="42_commityActity.html">
            
                <a href="42_commityActity.html">
            
                    
                    Community Activity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="13.4" data-path="43_commityEnters/">
            
                <a href="43_commityEnters/">
            
                    
                    Community Entrance
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Landing scheme</li>
        
        
    
        <li class="chapter " data-level="14.1" data-path="44_case.html">
            
                <a href="44_case.html">
            
                    
                    Landing case
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Other</li>
        
        
    
        <li class="chapter " data-level="15.1" data-path="45_faq.html">
            
                <a href="45_faq.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="15.2" data-path="46_supportOnline/">
            
                <a href="46_supportOnline/">
            
                    
                    Online technical support
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Contract template</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>Some contract templates of Jin Dian can help developers learn quickly <code>Solidity</code>,and quickly start the development. Create excellent Dapp applications based on Simplechain.</p>
<h2 id="vote"><a name="vote" class="plugin-anchor" href="#vote"><i class="fa fa-link" aria-hidden="true"></i></a>Vote</h2>
<p>The following contract is quite complex, but shows many Solidity functions. It achieved a voting contract.
Of course, the main problem of electronic voting is how to distribute the voting rights to the right people and how to prevent manipulation.
We will not solve all the problems here, but at least we will show how to conduct delegation voting. At the same time, counting votes is also <strong>Automatic and fully transparent</strong> &#x3002;</p>
<p>Our idea is to create a contract for each (vote) vote and provide short for each option. Then as the creator of the contract-the chairman, he will give each independent address the right to vote. People behind the address can choose to vote by themselves or entrust people they trust to vote. At the end of the voting time&#xFF0C;<code>winningProposal()</code> the proposal that received the most votes will be returned.</p>
<pre><code class="lang-sh">    pragma solidity ^0.4.22;

    /// @title &#x59D4;&#x6258;&#x6295;&#x7968;
    contract Ballot {
        // &#x8FD9;&#x91CC;&#x58F0;&#x660E;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x590D;&#x5408;&#x7C7B;&#x578B;&#x7528;&#x4E8E;&#x7A0D;&#x540E;&#x7684;&#x53D8;&#x91CF;
        // &#x5B83;&#x7528;&#x6765;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x9009;&#x6C11;
        struct Voter {
            uint weight; // &#x8BA1;&#x7968;&#x7684;&#x6743;&#x91CD;
            bool voted;  // &#x82E5;&#x4E3A;&#x771F;&#xFF0C;&#x4EE3;&#x8868;&#x8BE5;&#x4EBA;&#x5DF2;&#x6295;&#x7968;
            address delegate; // &#x88AB;&#x59D4;&#x6258;&#x4EBA;
            uint vote;   // &#x6295;&#x7968;&#x63D0;&#x6848;&#x7684;&#x7D22;&#x5F15;
        }

        // &#x63D0;&#x6848;&#x7684;&#x7C7B;&#x578B;
        struct Proposal {
            bytes32 name;   // &#x7B80;&#x79F0;&#xFF08;&#x6700;&#x957F;32&#x4E2A;&#x5B57;&#x8282;&#xFF09;
            uint voteCount; // &#x5F97;&#x7968;&#x6570;
        }

        address public chairperson;

        // &#x8FD9;&#x58F0;&#x660E;&#x4E86;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#x53D8;&#x91CF;&#xFF0C;&#x4E3A;&#x6BCF;&#x4E2A;&#x53EF;&#x80FD;&#x7684;&#x5730;&#x5740;&#x5B58;&#x50A8;&#x4E00;&#x4E2A; `Voter`&#x3002;
        mapping(address =&gt; Voter) public voters;

        // &#x4E00;&#x4E2A; `Proposal` &#x7ED3;&#x6784;&#x7C7B;&#x578B;&#x7684;&#x52A8;&#x6001;&#x6570;&#x7EC4;
        Proposal[] public proposals;

        /// &#x4E3A; `proposalNames` &#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x63D0;&#x6848;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#xFF08;&#x6295;&#x7968;&#xFF09;&#x8868;&#x51B3;
        constructor(bytes32[] proposalNames) public {
            chairperson = msg.sender;
            voters[chairperson].weight = 1;
            //&#x5BF9;&#x4E8E;&#x63D0;&#x4F9B;&#x7684;&#x6BCF;&#x4E2A;&#x63D0;&#x6848;&#x540D;&#x79F0;&#xFF0C;
            //&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684; Proposal &#x5BF9;&#x8C61;&#x5E76;&#x628A;&#x5B83;&#x6DFB;&#x52A0;&#x5230;&#x6570;&#x7EC4;&#x7684;&#x672B;&#x5C3E;&#x3002;
            <span class="hljs-keyword">for</span> (uint i = 0; i &lt; proposalNames.length; i++) {
                // `Proposal({...})` &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4E34;&#x65F6; Proposal &#x5BF9;&#x8C61;&#xFF0C;
                // `proposals.push(...)` &#x5C06;&#x5176;&#x6DFB;&#x52A0;&#x5230; `proposals` &#x7684;&#x672B;&#x5C3E;
                proposals.push(Proposal({
                    name: proposalNames[i],
                    voteCount: 0
                }));
            }
        }

        // &#x6388;&#x6743; `voter` &#x5BF9;&#x8FD9;&#x4E2A;&#xFF08;&#x6295;&#x7968;&#xFF09;&#x8868;&#x51B3;&#x8FDB;&#x884C;&#x6295;&#x7968;
        // &#x53EA;&#x6709; `chairperson` &#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x8BE5;&#x51FD;&#x6570;&#x3002;
        <span class="hljs-keyword">function</span> giveRightToVote(address voter) public {
            // &#x82E5; `require` &#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#x4E3A; `<span class="hljs-literal">false</span>`&#xFF0C;
            // &#x5219;&#x7EC8;&#x6B62;&#x6267;&#x884C;&#xFF0C;&#x64A4;&#x9500;&#x6240;&#x6709;&#x5BF9;&#x72B6;&#x6001;&#x548C;&#x4EE5;&#x592A;&#x5E01;&#x4F59;&#x989D;&#x7684;&#x6539;&#x52A8;&#x3002;
            // &#x5728;&#x65E7;&#x7248;&#x7684; EVM &#x4E2D;&#x8FD9;&#x66FE;&#x7ECF;&#x4F1A;&#x6D88;&#x8017;&#x6240;&#x6709; gas&#xFF0C;&#x4F46;&#x73B0;&#x5728;&#x4E0D;&#x4F1A;&#x4E86;&#x3002;
            // &#x4F7F;&#x7528; require &#x6765;&#x68C0;&#x67E5;&#x51FD;&#x6570;&#x662F;&#x5426;&#x88AB;&#x6B63;&#x786E;&#x5730;&#x8C03;&#x7528;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x597D;&#x4E60;&#x60EF;&#x3002;
            // &#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x5728; require &#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x4E2D;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x5BF9;&#x9519;&#x8BEF;&#x60C5;&#x51B5;&#x7684;&#x89E3;&#x91CA;&#x3002;
            require(
                msg.sender == chairperson,
                <span class="hljs-string">&quot;Only chairperson can give right to vote.&quot;</span>
            );
            require(
                !voters[voter].voted,
                <span class="hljs-string">&quot;The voter already voted.&quot;</span>
            );
            require(voters[voter].weight == 0);
            voters[voter].weight = 1;
        }

        /// &#x628A;&#x4F60;&#x7684;&#x6295;&#x7968;&#x59D4;&#x6258;&#x5230;&#x6295;&#x7968;&#x8005; `to`&#x3002;
        <span class="hljs-keyword">function</span> delegate(address to) public {
            // &#x4F20;&#x5F15;&#x7528;
            Voter storage sender = voters[msg.sender];
            require(!sender.voted, <span class="hljs-string">&quot;You already voted.&quot;</span>);

            require(to != msg.sender, <span class="hljs-string">&quot;Self-delegation is disallowed.&quot;</span>);

            // &#x59D4;&#x6258;&#x662F;&#x53EF;&#x4EE5;&#x4F20;&#x9012;&#x7684;&#xFF0C;&#x53EA;&#x8981;&#x88AB;&#x59D4;&#x6258;&#x8005; `to` &#x4E5F;&#x8BBE;&#x7F6E;&#x4E86;&#x59D4;&#x6258;&#x3002;
            // &#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x8FD9;&#x79CD;&#x5FAA;&#x73AF;&#x59D4;&#x6258;&#x662F;&#x5371;&#x9669;&#x7684;&#x3002;&#x56E0;&#x4E3A;&#xFF0C;&#x5982;&#x679C;&#x4F20;&#x9012;&#x7684;&#x94FE;&#x6761;&#x592A;&#x957F;&#xFF0C;
            // &#x5219;&#x53EF;&#x80FD;&#x9700;&#x6D88;&#x8017;&#x7684;gas&#x8981;&#x591A;&#x4E8E;&#x533A;&#x5757;&#x4E2D;&#x5269;&#x4F59;&#x7684;&#xFF08;&#x5927;&#x4E8E;&#x533A;&#x5757;&#x8BBE;&#x7F6E;&#x7684;gasLimit&#xFF09;&#xFF0C;
            // &#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x59D4;&#x6258;&#x4E0D;&#x4F1A;&#x88AB;&#x6267;&#x884C;&#x3002;
            // &#x800C;&#x5728;&#x53E6;&#x4E00;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x5F62;&#x6210;&#x95ED;&#x73AF;&#xFF0C;&#x5219;&#x4F1A;&#x8BA9;&#x5408;&#x7EA6;&#x5B8C;&#x5168;&#x5361;&#x4F4F;&#x3002;
            <span class="hljs-keyword">while</span> (voters[to].delegate != address(0)) {
                to = voters[to].delegate;

                // &#x4E0D;&#x5141;&#x8BB8;&#x95ED;&#x73AF;&#x59D4;&#x6258;
                require(to != msg.sender, <span class="hljs-string">&quot;Found loop in delegation.&quot;</span>);
            }

            // `sender` &#x662F;&#x4E00;&#x4E2A;&#x5F15;&#x7528;, &#x76F8;&#x5F53;&#x4E8E;&#x5BF9; `voters[msg.sender].voted` &#x8FDB;&#x884C;&#x4FEE;&#x6539;
            sender.voted = <span class="hljs-literal">true</span>;
            sender.delegate = to;
            Voter storage delegate_ = voters[to];
            <span class="hljs-keyword">if</span> (delegate_.voted) {
                // &#x82E5;&#x88AB;&#x59D4;&#x6258;&#x8005;&#x5DF2;&#x7ECF;&#x6295;&#x8FC7;&#x7968;&#x4E86;&#xFF0C;&#x76F4;&#x63A5;&#x589E;&#x52A0;&#x5F97;&#x7968;&#x6570;
                proposals[delegate_.vote].voteCount += sender.weight;
            } <span class="hljs-keyword">else</span> {
                // &#x82E5;&#x88AB;&#x59D4;&#x6258;&#x8005;&#x8FD8;&#x6CA1;&#x6295;&#x7968;&#xFF0C;&#x589E;&#x52A0;&#x59D4;&#x6258;&#x8005;&#x7684;&#x6743;&#x91CD;
                delegate_.weight += sender.weight;
            }
        }

        /// &#x628A;&#x4F60;&#x7684;&#x7968;(&#x5305;&#x62EC;&#x59D4;&#x6258;&#x7ED9;&#x4F60;&#x7684;&#x7968;)&#xFF0C;
        /// &#x6295;&#x7ED9;&#x63D0;&#x6848; `proposals[proposal].name`.
        <span class="hljs-keyword">function</span> vote(uint proposal) public {
            Voter storage sender = voters[msg.sender];
            require(!sender.voted, <span class="hljs-string">&quot;Already voted.&quot;</span>);
            sender.voted = <span class="hljs-literal">true</span>;
            sender.vote = proposal;

            // &#x5982;&#x679C; `proposal` &#x8D85;&#x8FC7;&#x4E86;&#x6570;&#x7EC4;&#x7684;&#x8303;&#x56F4;&#xFF0C;&#x5219;&#x4F1A;&#x81EA;&#x52A8;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x5E76;&#x6062;&#x590D;&#x6240;&#x6709;&#x7684;&#x6539;&#x52A8;
            proposals[proposal].voteCount += sender.weight;
        }

        /// @dev &#x7ED3;&#x5408;&#x4E4B;&#x524D;&#x6240;&#x6709;&#x7684;&#x6295;&#x7968;&#xFF0C;&#x8BA1;&#x7B97;&#x51FA;&#x6700;&#x7EC8;&#x80DC;&#x51FA;&#x7684;&#x63D0;&#x6848;
        <span class="hljs-keyword">function</span> winningProposal() public view
                returns (uint winningProposal_)
        {
            uint winningVoteCount = 0;
            <span class="hljs-keyword">for</span> (uint p = 0; p &lt; proposals.length; p++) {
                <span class="hljs-keyword">if</span> (proposals[p].voteCount &gt; winningVoteCount) {
                    winningVoteCount = proposals[p].voteCount;
                    winningProposal_ = p;
                }
            }
        }

        // &#x8C03;&#x7528; winningProposal() &#x51FD;&#x6570;&#x4EE5;&#x83B7;&#x53D6;&#x63D0;&#x6848;&#x6570;&#x7EC4;&#x4E2D;&#x83B7;&#x80DC;&#x8005;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x5E76;&#x4EE5;&#x6B64;&#x8FD4;&#x56DE;&#x83B7;&#x80DC;&#x8005;&#x7684;&#x540D;&#x79F0;
        <span class="hljs-keyword">function</span> winnerName() public view
                returns (bytes32 winnerName_)
        {
            winnerName_ = proposals[winningProposal()].name;
        }
    }
</code></pre>
<p><strong>Possible optimization</strong></p>
<p>At present, in order to distribute the voting rights to all participants, many transactions need to be executed. Do you have a better idea?</p>
<p><strong>Secret bidding (blind auction)</strong></p>
<p>In this section, we will show how to easily create a secret bidding contract on Simplechain.
We will start from the public auction, everyone can see the bid, and then extend this contract to blind auction contract,
The actual bid cannot be seen before the bidding period ends.</p>
<p><strong>Simple public auction</strong></p>
<p>The general idea of the following simple auction contract is that everyone can send their bids within the bidding period.
The bid already contains funds/Ethernet coins to bind bidders to their bids.
If the highest bid is raised (it is exceeded by other bidders), the former highest bidder can get her money back. At the end of the bidding period, the beneficiary needs to manually call the contract to receive his money-the contract cannot activate the receipt by itself.</p>
<pre><code class="lang-sh">    pragma solidity ^0.4.22;

    contract SimpleAuction {
        // &#x62CD;&#x5356;&#x7684;&#x53C2;&#x6570;&#x3002;
        address public beneficiary;
        // &#x65F6;&#x95F4;&#x662F;unix&#x7684;&#x7EDD;&#x5BF9;&#x65F6;&#x95F4;&#x6233;&#xFF08;&#x81EA;1970-01-01&#x4EE5;&#x6765;&#x7684;&#x79D2;&#x6570;&#xFF09;
        // &#x6216;&#x4EE5;&#x79D2;&#x4E3A;&#x5355;&#x4F4D;&#x7684;&#x65F6;&#x95F4;&#x6BB5;&#x3002;
        uint public auctionEnd;

        // &#x62CD;&#x5356;&#x7684;&#x5F53;&#x524D;&#x72B6;&#x6001;
        address public highestBidder;
        uint public highestBid;

        //&#x53EF;&#x4EE5;&#x53D6;&#x56DE;&#x7684;&#x4E4B;&#x524D;&#x7684;&#x51FA;&#x4EF7;
        mapping(address =&gt; uint) pendingReturns;

        // &#x62CD;&#x5356;&#x7ED3;&#x675F;&#x540E;&#x8BBE;&#x4E3A; <span class="hljs-literal">true</span>&#xFF0C;&#x5C06;&#x7981;&#x6B62;&#x6240;&#x6709;&#x7684;&#x53D8;&#x66F4;
        bool ended;

        // &#x53D8;&#x66F4;&#x89E6;&#x53D1;&#x7684;&#x4E8B;&#x4EF6;
        event HighestBidIncreased(address bidder, uint amount);
        event AuctionEnded(address winner, uint amount);

        // &#x4EE5;&#x4E0B;&#x662F;&#x6240;&#x8C13;&#x7684; natspec &#x6CE8;&#x91CA;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E09;&#x4E2A;&#x659C;&#x6760;&#x6765;&#x8BC6;&#x522B;&#x3002;
        // &#x5F53;&#x7528;&#x6237;&#x88AB;&#x8981;&#x6C42;&#x786E;&#x8BA4;&#x4EA4;&#x6613;&#x65F6;&#x5C06;&#x663E;&#x793A;&#x3002;

        /// &#x4EE5;&#x53D7;&#x76CA;&#x8005;&#x5730;&#x5740; `_beneficiary` &#x7684;&#x540D;&#x4E49;&#xFF0C;
        /// &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x62CD;&#x5356;&#xFF0C;&#x62CD;&#x5356;&#x65F6;&#x95F4;&#x4E3A; `_biddingTime` &#x79D2;&#x3002;
        constructor(
            uint _biddingTime,
            address _beneficiary
        ) public {
            beneficiary = _beneficiary;
            auctionEnd = now + _biddingTime;
        }

        /// &#x5BF9;&#x62CD;&#x5356;&#x8FDB;&#x884C;&#x51FA;&#x4EF7;&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x51FA;&#x4EF7;&#x968F;&#x4EA4;&#x6613;&#x4E00;&#x8D77;&#x53D1;&#x9001;&#x3002;
        /// &#x5982;&#x679C;&#x6CA1;&#x6709;&#x5728;&#x62CD;&#x5356;&#x4E2D;&#x80DC;&#x51FA;&#xFF0C;&#x5219;&#x8FD4;&#x8FD8;&#x51FA;&#x4EF7;&#x3002;
        <span class="hljs-keyword">function</span> bid() public payable {
            // &#x53C2;&#x6570;&#x4E0D;&#x662F;&#x5FC5;&#x8981;&#x7684;&#x3002;&#x56E0;&#x4E3A;&#x6240;&#x6709;&#x7684;&#x4FE1;&#x606F;&#x5DF2;&#x7ECF;&#x5305;&#x542B;&#x5728;&#x4E86;&#x4EA4;&#x6613;&#x4E2D;&#x3002;
            // &#x5BF9;&#x4E8E;&#x80FD;&#x63A5;&#x6536;&#x4EE5;&#x592A;&#x5E01;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5173;&#x952E;&#x5B57; payable &#x662F;&#x5FC5;&#x987B;&#x7684;&#x3002;

            // &#x5982;&#x679C;&#x62CD;&#x5356;&#x5DF2;&#x7ED3;&#x675F;&#xFF0C;&#x64A4;&#x9500;&#x51FD;&#x6570;&#x7684;&#x8C03;&#x7528;&#x3002;
            require(
                now &lt;= auctionEnd,
                <span class="hljs-string">&quot;Auction already ended.&quot;</span>
            );

            // &#x5982;&#x679C;&#x51FA;&#x4EF7;&#x4E0D;&#x591F;&#x9AD8;&#xFF0C;&#x8FD4;&#x8FD8;&#x4F60;&#x7684;&#x94B1;
            require(
                msg.value &gt; highestBid,
                <span class="hljs-string">&quot;There already is a higher bid.&quot;</span>
            );

            <span class="hljs-keyword">if</span> (highestBid != 0) {
                // &#x8FD4;&#x8FD8;&#x51FA;&#x4EF7;&#x65F6;&#xFF0C;&#x7B80;&#x5355;&#x5730;&#x76F4;&#x63A5;&#x8C03;&#x7528; highestBidder.send(highestBid) &#x51FD;&#x6570;&#xFF0C;
                // &#x662F;&#x6709;&#x5B89;&#x5168;&#x98CE;&#x9669;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x6709;&#x53EF;&#x80FD;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x975E;&#x4FE1;&#x4EFB;&#x5408;&#x7EA6;&#x3002;
                // &#x66F4;&#x4E3A;&#x5B89;&#x5168;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x8BA9;&#x63A5;&#x6536;&#x65B9;&#x81EA;&#x5DF1;&#x63D0;&#x53D6;&#x91D1;&#x94B1;&#x3002;
                pendingReturns[highestBidder] += highestBid;
            }
            highestBidder = msg.sender;
            highestBid = msg.value;
            emit HighestBidIncreased(msg.sender, msg.value);
        }

        /// &#x53D6;&#x56DE;&#x51FA;&#x4EF7;&#xFF08;&#x5F53;&#x8BE5;&#x51FA;&#x4EF7;&#x5DF2;&#x88AB;&#x8D85;&#x8D8A;&#xFF09;
        <span class="hljs-keyword">function</span> withdraw() public returns (bool) {
            uint amount = pendingReturns[msg.sender];
            <span class="hljs-keyword">if</span> (amount &gt; 0) {
                // &#x8FD9;&#x91CC;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x8BBE;&#x96F6;&#x503C;&#x3002;
                // &#x56E0;&#x4E3A;&#xFF0C;&#x4F5C;&#x4E3A;&#x63A5;&#x6536;&#x8C03;&#x7528;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;
                // &#x63A5;&#x6536;&#x8005;&#x53EF;&#x4EE5;&#x5728; `send` &#x8FD4;&#x56DE;&#x4E4B;&#x524D;&#xFF0C;&#x91CD;&#x65B0;&#x8C03;&#x7528;&#x8BE5;&#x51FD;&#x6570;&#x3002;
                pendingReturns[msg.sender] = 0;

                <span class="hljs-keyword">if</span> (!msg.sender.send(amount)) {
                    // &#x8FD9;&#x91CC;&#x4E0D;&#x9700;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x53EA;&#x9700;&#x91CD;&#x7F6E;&#x672A;&#x4ED8;&#x6B3E;
                    pendingReturns[msg.sender] = amount;
                    <span class="hljs-built_in">return</span> <span class="hljs-literal">false</span>;
                }
            }
            <span class="hljs-built_in">return</span> <span class="hljs-literal">true</span>;
        }

        /// &#x7ED3;&#x675F;&#x62CD;&#x5356;&#xFF0C;&#x5E76;&#x628A;&#x6700;&#x9AD8;&#x7684;&#x51FA;&#x4EF7;&#x53D1;&#x9001;&#x7ED9;&#x53D7;&#x76CA;&#x4EBA;
        <span class="hljs-keyword">function</span> auctionEnd() public {
            // &#x5BF9;&#x4E8E;&#x53EF;&#x4E0E;&#x5176;&#x4ED6;&#x5408;&#x7EA6;&#x4EA4;&#x4E92;&#x7684;&#x51FD;&#x6570;&#xFF08;&#x610F;&#x5473;&#x7740;&#x5B83;&#x4F1A;&#x8C03;&#x7528;&#x5176;&#x4ED6;&#x51FD;&#x6570;&#x6216;&#x53D1;&#x9001;&#x4EE5;&#x592A;&#x5E01;&#xFF09;&#xFF0C;
            // &#x4E00;&#x4E2A;&#x597D;&#x7684;&#x6307;&#x5BFC;&#x65B9;&#x9488;&#x662F;&#x5C06;&#x5176;&#x7ED3;&#x6784;&#x5206;&#x4E3A;&#x4E09;&#x4E2A;&#x9636;&#x6BB5;&#xFF1A;
            // 1. &#x68C0;&#x67E5;&#x6761;&#x4EF6;
            // 2. &#x6267;&#x884C;&#x52A8;&#x4F5C; (&#x53EF;&#x80FD;&#x4F1A;&#x6539;&#x53D8;&#x6761;&#x4EF6;)
            // 3. &#x4E0E;&#x5176;&#x4ED6;&#x5408;&#x7EA6;&#x4EA4;&#x4E92;
            // &#x5982;&#x679C;&#x8FD9;&#x4E9B;&#x9636;&#x6BB5;&#x76F8;&#x6DF7;&#x5408;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x5408;&#x7EA6;&#x53EF;&#x80FD;&#x4F1A;&#x56DE;&#x8C03;&#x5F53;&#x524D;&#x5408;&#x7EA6;&#x5E76;&#x4FEE;&#x6539;&#x72B6;&#x6001;&#xFF0C;
            // &#x6216;&#x8005;&#x5BFC;&#x81F4;&#x67D0;&#x4E9B;&#x6548;&#x679C;&#xFF08;&#x6BD4;&#x5982;&#x652F;&#x4ED8;&#x4EE5;&#x592A;&#x5E01;&#xFF09;&#x591A;&#x6B21;&#x751F;&#x6548;&#x3002;
            // &#x5982;&#x679C;&#x5408;&#x7EA6;&#x5185;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x5305;&#x542B;&#x4E86;&#x4E0E;&#x5916;&#x90E8;&#x5408;&#x7EA6;&#x7684;&#x4EA4;&#x4E92;&#xFF0C;
            // &#x5219;&#x5B83;&#x4E5F;&#x4F1A;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x4E0E;&#x5916;&#x90E8;&#x5408;&#x7EA6;&#x6709;&#x4EA4;&#x4E92;&#x7684;&#x3002;

            // 1. &#x6761;&#x4EF6;
            require(now &gt;= auctionEnd, <span class="hljs-string">&quot;Auction not yet ended.&quot;</span>);
            require(!ended, <span class="hljs-string">&quot;auctionEnd has already been called.&quot;</span>);

            // 2. &#x751F;&#x6548;
            ended = <span class="hljs-literal">true</span>;
            emit AuctionEnded(highestBidder, highestBid);

            // 3. &#x4EA4;&#x4E92;
            beneficiary.transfer(highestBid);
        }
    }
</code></pre>
<h2 id="secret-auction-blind-auction"><a name="secret-auction-blind-auction" class="plugin-anchor" href="#secret-auction-blind-auction"><i class="fa fa-link" aria-hidden="true"></i></a>Secret auction (blind auction)</h2>
<p>The previous public auction will then be expanded to a secret auction.
The advantage of secret auction is that there will be no time pressure before the bid ends.
Secret auction on a transparent computing platform sounds self-contradictory, but cryptography can realize it.</p>
<p>In <strong>Bidding period</strong> &#xFF0C;the bidder did not actually send her bid, but only sent a hash version of the bid.
Since it is almost impossible to find two (long enough) values at present and their hash values are equal, tenderers can submit quotations in this way.
After the bidding is completed, bidders must disclose their bids: they send their bids unencrypted, and the contract checks whether the hash value of the bid is the same as that provided during the bidding period.</p>
<p>Another challenge is how to make the auction work at the same time <strong>Binding and secret</strong> :
The only way to prevent the bidder from not paying after she wins the auction is to let her send out the money together with the bid.
However, since the transfer of funds cannot be hidden in Simplechain, anyone can see the transferred funds.</p>
<p>The following contract solves this problem by accepting any value greater than the highest bid.
Of course, because this can only be checked at the disclosure stage, some bids may be <strong>Invalid</strong> of&#xFF0C;
Moreover, this is intentional (together with the high bid, it even provides a clear mark to identify invalid bids):
Bidders can confuse competitors by setting several high or low invalid bids.</p>
<pre><code class="lang-sh">    pragma solidity &gt;0.4.23 &lt;0.5.0;

    contract BlindAuction {
        struct Bid {
            bytes32 blindedBid;
            uint deposit;
        }

        address public beneficiary;
        uint public biddingEnd;
        uint public revealEnd;
        bool public ended;

        mapping(address =&gt; Bid[]) public bids;

        address public highestBidder;
        uint public highestBid;

        // &#x53EF;&#x4EE5;&#x53D6;&#x56DE;&#x7684;&#x4E4B;&#x524D;&#x7684;&#x51FA;&#x4EF7;
        mapping(address =&gt; uint) pendingReturns;

        event AuctionEnded(address winner, uint highestBid);

        /// &#x4F7F;&#x7528; modifier &#x53EF;&#x4EE5;&#x66F4;&#x4FBF;&#x6377;&#x7684;&#x6821;&#x9A8C;&#x51FD;&#x6570;&#x7684;&#x5165;&#x53C2;&#x3002;
        /// `onlyBefore` &#x4F1A;&#x88AB;&#x7528;&#x4E8E;&#x540E;&#x9762;&#x7684; `bid` &#x51FD;&#x6570;&#xFF1A;
        /// &#x65B0;&#x7684;&#x51FD;&#x6570;&#x4F53;&#x662F;&#x7531; modifier &#x672C;&#x8EAB;&#x7684;&#x51FD;&#x6570;&#x4F53;&#xFF0C;&#x5E76;&#x7528;&#x539F;&#x51FD;&#x6570;&#x4F53;&#x66FF;&#x6362; `_;` &#x8BED;&#x53E5;&#x6765;&#x7EC4;&#x6210;&#x7684;&#x3002;
        modifier onlyBefore(uint _time) { require(now &lt; _time); _; }
        modifier onlyAfter(uint _time) { require(now &gt; _time); _; }

        constructor(
            uint _biddingTime,
            uint _revealTime,
            address _beneficiary
        ) public {
            beneficiary = _beneficiary;
            biddingEnd = now + _biddingTime;
            revealEnd = biddingEnd + _revealTime;
        }

        /// &#x53EF;&#x4EE5;&#x901A;&#x8FC7; `_blindedBid` = keccak256(value, fake, secret)
        /// &#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x79D8;&#x5BC6;&#x7ADE;&#x62CD;&#x3002;
        /// &#x53EA;&#x6709;&#x5728;&#x51FA;&#x4EF7;&#x62AB;&#x9732;&#x9636;&#x6BB5;&#x88AB;&#x6B63;&#x786E;&#x62AB;&#x9732;&#xFF0C;&#x5DF2;&#x53D1;&#x9001;&#x7684;&#x4EE5;&#x592A;&#x5E01;&#x624D;&#x4F1A;&#x88AB;&#x9000;&#x8FD8;&#x3002;
        /// &#x5982;&#x679C;&#x4E0E;&#x51FA;&#x4EF7;&#x4E00;&#x8D77;&#x53D1;&#x9001;&#x7684;&#x4EE5;&#x592A;&#x5E01;&#x81F3;&#x5C11;&#x4E3A; &#x201C;value&#x201D; &#x4E14; &#x201C;fake&#x201D; &#x4E0D;&#x4E3A;&#x771F;&#xFF0C;&#x5219;&#x51FA;&#x4EF7;&#x6709;&#x6548;&#x3002;
        /// &#x5C06; &#x201C;fake&#x201D; &#x8BBE;&#x7F6E;&#x4E3A; <span class="hljs-literal">true</span> &#xFF0C;&#x7136;&#x540E;&#x53D1;&#x9001;&#x6EE1;&#x8DB3;&#x8BA2;&#x91D1;&#x91D1;&#x989D;&#x4F46;&#x53C8;&#x4E0D;&#x4E0E;&#x51FA;&#x4EF7;&#x76F8;&#x540C;&#x7684;&#x91D1;&#x989D;&#x662F;&#x9690;&#x85CF;&#x5B9E;&#x9645;&#x51FA;&#x4EF7;&#x7684;&#x65B9;&#x6CD5;&#x3002;
        /// &#x540C;&#x4E00;&#x4E2A;&#x5730;&#x5740;&#x53EF;&#x4EE5;&#x653E;&#x7F6E;&#x591A;&#x4E2A;&#x51FA;&#x4EF7;&#x3002;
        <span class="hljs-keyword">function</span> bid(bytes32 _blindedBid)
            public
            payable
            onlyBefore(biddingEnd)
        {
            bids[msg.sender].push(Bid({
                blindedBid: _blindedBid,
                deposit: msg.value
            }));
        }

        /// &#x62AB;&#x9732;&#x4F60;&#x7684;&#x79D8;&#x5BC6;&#x7ADE;&#x62CD;&#x51FA;&#x4EF7;&#x3002;
        /// &#x5BF9;&#x4E8E;&#x6240;&#x6709;&#x6B63;&#x786E;&#x62AB;&#x9732;&#x7684;&#x65E0;&#x6548;&#x51FA;&#x4EF7;&#x4EE5;&#x53CA;&#x9664;&#x6700;&#x9AD8;&#x51FA;&#x4EF7;&#x4EE5;&#x5916;&#x7684;&#x6240;&#x6709;&#x51FA;&#x4EF7;&#xFF0C;&#x4F60;&#x90FD;&#x5C06;&#x83B7;&#x5F97;&#x9000;&#x6B3E;&#x3002;
        <span class="hljs-keyword">function</span> reveal(
            uint[] _values,
            bool[] _fake,
            bytes32[] _secret
        )
            public
            onlyAfter(biddingEnd)
            onlyBefore(revealEnd)
        {
            uint length = bids[msg.sender].length;
            require(_values.length == length);
            require(_fake.length == length);
            require(_secret.length == length);

            uint refund;
            <span class="hljs-keyword">for</span> (uint i = 0; i &lt; length; i++) {
                Bid storage bid = bids[msg.sender][i];
                (uint value, bool fake, bytes32 secret) =
                        (_values[i], _fake[i], _secret[i]);
                <span class="hljs-keyword">if</span> (bid.blindedBid != keccak256(value, fake, secret)) {
                    // &#x51FA;&#x4EF7;&#x672A;&#x80FD;&#x6B63;&#x786E;&#x62AB;&#x9732;
                    // &#x4E0D;&#x8FD4;&#x8FD8;&#x8BA2;&#x91D1;
                    <span class="hljs-built_in">continue</span>;
                }
                refund += bid.deposit;
                <span class="hljs-keyword">if</span> (!fake &amp;&amp; bid.deposit &gt;= value) {
                    <span class="hljs-keyword">if</span> (placeBid(msg.sender, value))
                        refund -= value;
                }
                // &#x4F7F;&#x53D1;&#x9001;&#x8005;&#x4E0D;&#x53EF;&#x80FD;&#x518D;&#x6B21;&#x8BA4;&#x9886;&#x540C;&#x4E00;&#x7B14;&#x8BA2;&#x91D1;
                bid.blindedBid = bytes32(0);
            }
            msg.sender.transfer(refund);
        }

        // &#x8FD9;&#x662F;&#x4E00;&#x4E2A; <span class="hljs-string">&quot;internal&quot;</span> &#x51FD;&#x6570;&#xFF0C; &#x610F;&#x5473;&#x7740;&#x5B83;&#x53EA;&#x80FD;&#x5728;&#x672C;&#x5408;&#x7EA6;&#xFF08;&#x6216;&#x7EE7;&#x627F;&#x5408;&#x7EA6;&#xFF09;&#x5185;&#x88AB;&#x8C03;&#x7528;
        <span class="hljs-keyword">function</span> placeBid(address bidder, uint value) internal
                returns (bool success)
        {
            <span class="hljs-keyword">if</span> (value &lt;= highestBid) {
                <span class="hljs-built_in">return</span> <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">if</span> (highestBidder != address(0)) {
                // &#x8FD4;&#x8FD8;&#x4E4B;&#x524D;&#x7684;&#x6700;&#x9AD8;&#x51FA;&#x4EF7;
                pendingReturns[highestBidder] += highestBid;
            }
            highestBid = value;
            highestBidder = bidder;
            <span class="hljs-built_in">return</span> <span class="hljs-literal">true</span>;
        }

        /// &#x53D6;&#x56DE;&#x51FA;&#x4EF7;&#xFF08;&#x5F53;&#x8BE5;&#x51FA;&#x4EF7;&#x5DF2;&#x88AB;&#x8D85;&#x8D8A;&#xFF09;
        <span class="hljs-keyword">function</span> withdraw() public {
            uint amount = pendingReturns[msg.sender];
            <span class="hljs-keyword">if</span> (amount &gt; 0) {
                // &#x8FD9;&#x91CC;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x8BBE;&#x96F6;&#x503C;&#x3002;
                // &#x56E0;&#x4E3A;&#xFF0C;&#x4F5C;&#x4E3A;&#x63A5;&#x6536;&#x8C03;&#x7528;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;
                // &#x63A5;&#x6536;&#x8005;&#x53EF;&#x4EE5;&#x5728; `transfer` &#x8FD4;&#x56DE;&#x4E4B;&#x524D;&#x91CD;&#x65B0;&#x8C03;&#x7528;&#x8BE5;&#x51FD;&#x6570;&#x3002;&#xFF08;&#x53EF;&#x67E5;&#x770B;&#x4E0A;&#x9762;&#x5173;&#x4E8E;&#x2018;&#x6761;&#x4EF6; -&gt; &#x5F71;&#x54CD; -&gt; &#x4EA4;&#x4E92;&#x2019;&#x7684;&#x6807;&#x6CE8;&#xFF09;
                pendingReturns[msg.sender] = 0;

                msg.sender.transfer(amount);
            }
        }

        /// &#x7ED3;&#x675F;&#x62CD;&#x5356;&#xFF0C;&#x5E76;&#x628A;&#x6700;&#x9AD8;&#x7684;&#x51FA;&#x4EF7;&#x53D1;&#x9001;&#x7ED9;&#x53D7;&#x76CA;&#x4EBA;
        <span class="hljs-keyword">function</span> auctionEnd()
            public
            onlyAfter(revealEnd)
        {
            require(!ended);
            emit AuctionEnded(highestBidder, highestBid);
            ended = <span class="hljs-literal">true</span>;
            beneficiary.transfer(highestBid);
        }
    }
</code></pre>
<h2 id="secure-remote-purchase"><a name="secure-remote-purchase" class="plugin-anchor" href="#secure-remote-purchase"><i class="fa fa-link" aria-hidden="true"></i></a>Secure Remote purchase</h2>
<pre><code class="lang-sh">    pragma solidity ^0.4.22;

    contract Purchase {
        uint public value;
        address public seller;
        address public buyer;
        enum State { Created, Locked, Inactive }
        State public state;

        //&#x786E;&#x4FDD; `msg.value` &#x662F;&#x4E00;&#x4E2A;&#x5076;&#x6570;&#x3002;
        //&#x5982;&#x679C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x5947;&#x6570;&#xFF0C;&#x5219;&#x5B83;&#x5C06;&#x88AB;&#x622A;&#x65AD;&#x3002;
        //&#x901A;&#x8FC7;&#x4E58;&#x6CD5;&#x68C0;&#x67E5;&#x5B83;&#x4E0D;&#x662F;&#x5947;&#x6570;&#x3002;
        constructor() public payable {
            seller = msg.sender;
            value = msg.value / 2;
            require((2 * value) == msg.value, <span class="hljs-string">&quot;Value has to be even.&quot;</span>);
        }

        modifier condition(bool _condition) {
            require(_condition);
            _;
        }

        modifier <span class="hljs-function"><span class="hljs-title">onlyBuyer</span></span>() {
            require(
                msg.sender == buyer,
                <span class="hljs-string">&quot;Only buyer can call this.&quot;</span>
            );
            _;
        }

        modifier <span class="hljs-function"><span class="hljs-title">onlySeller</span></span>() {
            require(
                msg.sender == seller,
                <span class="hljs-string">&quot;Only seller can call this.&quot;</span>
            );
            _;
        }

        modifier <span class="hljs-keyword">in</span>State(State _state) {
            require(
                state == _state,
                <span class="hljs-string">&quot;Invalid state.&quot;</span>
            );
            _;
        }

        event Aborted();
        event PurchaseConfirmed();
        event ItemReceived();

        ///&#x4E2D;&#x6B62;&#x8D2D;&#x4E70;&#x5E76;&#x56DE;&#x6536;&#x4EE5;&#x592A;&#x5E01;&#x3002;
        ///&#x53EA;&#x80FD;&#x5728;&#x5408;&#x7EA6;&#x88AB;&#x9501;&#x5B9A;&#x4E4B;&#x524D;&#x7531;&#x5356;&#x5BB6;&#x8C03;&#x7528;&#x3002;
        <span class="hljs-keyword">function</span> abort()
            public
            onlySeller
            <span class="hljs-keyword">in</span>State(State.Created)
        {
            emit Aborted();
            state = State.Inactive;
            seller.transfer(address(this).balance);
        }

        /// &#x4E70;&#x5BB6;&#x786E;&#x8BA4;&#x8D2D;&#x4E70;&#x3002;
        /// &#x4EA4;&#x6613;&#x5FC5;&#x987B;&#x5305;&#x542B; `2 * value` &#x4E2A;&#x4EE5;&#x592A;&#x5E01;&#x3002;
        /// &#x4EE5;&#x592A;&#x5E01;&#x4F1A;&#x88AB;&#x9501;&#x5B9A;&#xFF0C;&#x76F4;&#x5230; confirmReceived &#x88AB;&#x8C03;&#x7528;&#x3002;
        <span class="hljs-keyword">function</span> confirmPurchase()
            public
            <span class="hljs-keyword">in</span>State(State.Created)
            condition(msg.value == (2 * value))
            payable
        {
            emit PurchaseConfirmed();
            buyer = msg.sender;
            state = State.Locked;
        }

        /// &#x786E;&#x8BA4;&#x4F60;&#xFF08;&#x4E70;&#x5BB6;&#xFF09;&#x5DF2;&#x7ECF;&#x6536;&#x5230;&#x5546;&#x54C1;&#x3002;
        /// &#x8FD9;&#x4F1A;&#x91CA;&#x653E;&#x88AB;&#x9501;&#x5B9A;&#x7684;&#x4EE5;&#x592A;&#x5E01;&#x3002;
        <span class="hljs-keyword">function</span> confirmReceived()
            public
            onlyBuyer
            <span class="hljs-keyword">in</span>State(State.Locked)
        {
            emit ItemReceived();
            // &#x9996;&#x5148;&#x4FEE;&#x6539;&#x72B6;&#x6001;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x5426;&#x5219;&#x7684;&#x8BDD;&#xFF0C;&#x7531; `transfer` &#x6240;&#x8C03;&#x7528;&#x7684;&#x5408;&#x7EA6;&#x53EF;&#x4EE5;&#x56DE;&#x8C03;&#x8FDB;&#x8FD9;&#x91CC;&#xFF08;&#x518D;&#x6B21;&#x63A5;&#x6536;&#x4EE5;&#x592A;&#x5E01;&#xFF09;&#x3002;
            state = State.Inactive;

            // &#x6CE8;&#x610F;: &#x8FD9;&#x5B9E;&#x9645;&#x4E0A;&#x5141;&#x8BB8;&#x4E70;&#x65B9;&#x548C;&#x5356;&#x65B9;&#x963B;&#x6B62;&#x9000;&#x6B3E; - &#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x53D6;&#x56DE;&#x6A21;&#x5F0F;&#x3002;
            buyer.transfer(value);
            seller.transfer(address(this).balance);
        }
    }
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="19_understandSolidity/" class="navigation navigation-prev " aria-label="Previous page: understand Solidity">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="21_buildTest.html" class="navigation navigation-next " aria-label="Next page: Build Test network">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Contract template","level":"7.3","depth":1,"next":{"title":"Build Test network","level":"8.1","depth":1,"path":"21_buildTest.md","ref":"21_buildTest.md","articles":[]},"previous":{"title":"understand Solidity","level":"7.2","depth":1,"path":"19_understandSolidity/README.md","ref":"19_understandSolidity/README.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-lunr","-search","search-pro","language-picker","anchors"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"search-pro":{},"language-picker":{"grid-columns":3},"anchors":{},"livereload":{},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Simplechain Documentation","language":"en","gitbook":"*"},"file":{"path":"20_contractPattern.md","mtime":"2020-07-02T02:55:16.193Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-07-02T06:02:09.980Z"},"basePath":".","book":{"language":"en"}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-language-picker/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

