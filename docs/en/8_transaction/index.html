
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Transaction Â· Simplechain Documentation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-language-picker/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../9_block/" />
    
    
    <link rel="prev" href="../7_account.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Quick Start</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../1_quickStart.html">
            
                <a href="../1_quickStart.html">
            
                    
                    Quick Start
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../2_BuildNode/">
            
                <a href="../2_BuildNode/">
            
                    
                    Build Node
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Sipc Coin Negotiate</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../47_techniqueLanguage.html">
            
                <a href="../47_techniqueLanguage.html">
            
                    
                    Technical Manual
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../3_sipcCoin.html">
            
                <a href="../3_sipcCoin.html">
            
                    
                    Sipc Coin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../4_PublishCoin/">
            
                <a href="../4_PublishCoin/">
            
                    
                    Publish Coin
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Basic Data Struct</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../5_concoct.html">
            
                <a href="../5_concoct.html">
            
                    
                    Deploy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../6_genesis/">
            
                <a href="../6_genesis/">
            
                    
                    Genesis Block
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../7_account.html">
            
                <a href="../7_account.html">
            
                    
                    Account
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="4.4" data-path="./">
            
                <a href="./">
            
                    
                    Transaction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="../9_block/">
            
                <a href="../9_block/">
            
                    
                    Block
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="../10_transactionReceipt/">
            
                <a href="../10_transactionReceipt/">
            
                    
                    Transaction Receipt
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Construct</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../11_constructDesign/">
            
                <a href="../11_constructDesign/">
            
                    
                    Structure Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../12_structAndStore/">
            
                <a href="../12_structAndStore/">
            
                    
                    Data Struct and 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../50_togetherStep.html">
            
                <a href="../50_togetherStep.html">
            
                    
                    Data Synchronize
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Underlying Core Technology</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../13_p2pNetwork.html">
            
                <a href="../13_p2pNetwork.html">
            
                    
                    p2p network
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="../14_consensus/">
            
                <a href="../14_consensus/">
            
                    
                    Consensus mechanism
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="../15_virtualMache/">
            
                <a href="../15_virtualMache/">
            
                    
                    virtual machine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="../16_runMechanism/">
            
                <a href="../16_runMechanism/">
            
                    
                    Operating mechanism
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="../17_unusual.html">
            
                <a href="../17_unusual.html">
            
                    
                    Handle exceptions
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Smart contract</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../18_contract/">
            
                <a href="../18_contract/">
            
                    
                    Smart contract
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="../19_understandSolidity/">
            
                <a href="../19_understandSolidity/">
            
                    
                    understand Solidity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="../20_contractPattern.html">
            
                <a href="../20_contractPattern.html">
            
                    
                    Contract template
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Developer tools</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../21_buildTest.html">
            
                <a href="../21_buildTest.html">
            
                    
                    Build Test network
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="../22_sipcApi.html">
            
                <a href="../22_sipcApi.html">
            
                    
                    Sip API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="../23_crossChainApi.html">
            
                <a href="../23_crossChainApi.html">
            
                    
                    Cross-chain API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="../24_chromeWallet/">
            
                <a href="../24_chromeWallet/">
            
                    
                    SimPlug
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="../25_sdk/">
            
                <a href="../25_sdk/">
            
                    
                    SDK
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Cross-chain</li>
        
        
    
        <li class="chapter " data-level="9.1" data-path="../48_crossChain/">
            
                <a href="../48_crossChain/">
            
                    
                    Cross-chain solution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="../26_smallChain.html">
            
                <a href="../26_smallChain.html">
            
                    
                    Subchain template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="../49_crossChainOrder/">
            
                <a href="../49_crossChainOrder/">
            
                    
                    Cross-chain process
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Dapp develop</li>
        
        
    
        <li class="chapter " data-level="10.1" data-path="../27_dappFlow/">
            
                <a href="../27_dappFlow/">
            
                    
                    Dapp process carding
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.2" data-path="../28_editor.html">
            
                <a href="../28_editor.html">
            
                    
                    translater
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.3" data-path="../29_writeContract/">
            
                <a href="../29_writeContract/">
            
                    
                    Write contract
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.4" data-path="../30_frontRealize/">
            
                <a href="../30_frontRealize/">
            
                    
                    Front-end development
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Mining</li>
        
        
    
        <li class="chapter " data-level="11.1" data-path="../31_mining.html">
            
                <a href="../31_mining.html">
            
                    
                    sipc mining
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.2" data-path="../32_miningPool/">
            
                <a href="../32_miningPool/">
            
                    
                    MinePool access
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.3" data-path="../33_gpuMining/">
            
                <a href="../33_gpuMining/">
            
                    
                    GPU Mining
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.4" data-path="../34_SimPool/">
            
                <a href="../34_SimPool/">
            
                    
                    Simpool Mining
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.5" data-path="../35_SimpleNode_x1/">
            
                <a href="../35_SimpleNode_x1/">
            
                    
                    SimpleNode x1 Mining
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Client</li>
        
        
    
        <li class="chapter " data-level="12.1" data-path="../36_SIPC.html">
            
                <a href="../36_SIPC.html">
            
                    
                    SIPC.VIP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.2" data-path="../37_wallet/">
            
                <a href="../37_wallet/">
            
                    
                    Sipc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.3" data-path="../38_ChainBox/">
            
                <a href="../38_ChainBox/">
            
                    
                    ChainBox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.4" data-path="../39_blockBrowser/">
            
                <a href="../39_blockBrowser/">
            
                    
                    Explore
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Ecology</li>
        
        
    
        <li class="chapter " data-level="13.1" data-path="../40_tradePlateform.html">
            
                <a href="../40_tradePlateform.html">
            
                    
                    Exchange docking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="13.2" data-path="../41_commityProduct.html">
            
                <a href="../41_commityProduct.html">
            
                    
                    Community Project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="13.3" data-path="../42_commityActity.html">
            
                <a href="../42_commityActity.html">
            
                    
                    Community Activity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="13.4" data-path="../43_commityEnters/">
            
                <a href="../43_commityEnters/">
            
                    
                    Community Entrance
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Landing scheme</li>
        
        
    
        <li class="chapter " data-level="14.1" data-path="../44_case.html">
            
                <a href="../44_case.html">
            
                    
                    Landing case
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Other</li>
        
        
    
        <li class="chapter " data-level="15.1" data-path="../45_faq.html">
            
                <a href="../45_faq.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="15.2" data-path="../46_supportOnline/">
            
                <a href="../46_supportOnline/">
            
                    
                    Online technical support
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Transaction</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p><a href="https://www.simplechain.com/" target="_blank">SimpleChain</a>transaction refers to the transfer of certain assets from an external account to an account,
Or send a message to a smart contract.</p>
<p>in <a href="https://www.simplechain.com/" target="_blank">SimpleChain</a>network, transaction execution belongs to a transaction. It has the characteristics of atomicity, consistency, isolation and persistence.
`</p>
<ul>
<li><code>atom</code>&#xFF1A; Is the indivisible minimum execution unit, either do it or not do it.</li>
<li><code>same</code>&#xFF1A; the execution of the same transaction must change the Simplechain account book from one consistency state to another.</li>
<li><code>isolate</code>&#xFF1A; The transaction will not be disturbed by other transactions during execution.</li>
<li><code>lasting</code>&#xFF1A; once the transaction is submitted, the change to Simplechain account book is permanent. Subsequent operations will not affect it.</li>
</ul>
<p>Because it is a transaction type, we need to ensure that the transaction meets some design requirements before executing the transaction.</p>
<ul>
<li>The transaction must be unique and can distinguish different transactions and the same transaction cannot be submitted to the Ledger repeatedly.</li>
<li>The transaction content must not be changed, the transactions received by each node must be consistent, and the change of account book status during transaction execution is   also consistent.</li>
<li>Transactions must be legally signed. Only transactions with correct signatures can be executed.</li>
<li>Transactions cannot occupy too many system resources and affect the execution of other transactions.</li>
</ul>
<p>The design requirements for transactions involve all aspects of the software system, but the most basic part is the transaction data itself.</p>
<h2 id="transaction-data-structure"><a name="transaction-data-structure" class="plugin-anchor" href="#transaction-data-structure"><i class="fa fa-link" aria-hidden="true"></i></a>Transaction data structure</h2>
<p>The following figure is <a href="https://www.simplechain.com/" target="_blank">SimpleChain</a>transaction data structure is divided into four parts according to the purpose.</p>
<p><img src="1.png" alt="&#x4EA4;&#x6613;&#x6570;&#x636E;&#x7ED3;&#x6784;.png"></p>
<p>The beginning is a number of uint64 type, which is called a random number. Used to cancel transactions, prevent double flowers and modify <a href="https://www.simplechain.com/" target="_blank">SimpleChain</a> Nonce value of the account (account data structure).</p>
<p>The second part is about the setting of transaction execution restrictions, <code>gas</code> for willing to offer<a href="https://www.simplechain.com/" target="_blank">SimpleChain</a>maximum fuel limit for virtual machine operation.</p>
<p><code>gasPrice</code> is the unit price of fuel that is willing to pay. <code>gasPrcie * gas</code> it is the highest handling fee that is willing to pay for this transaction.</p>
<p>The third part is the input of transaction sender <a href="https://www.simplechain.com/" target="_blank">SimpleChain</a> the initial information for the virtual machine To execute this transaction: the virtual machine operation object (recipient), the asset (Value) transferred from the transaction sender To the operation object, and the virtual machine runtime input. When To is empty, it means that the virtual machine has no operation object. In this case, the virtual machine will use the input content to deploy a new contract.</p>
<p>The fourth part is the signature result of the transaction sender. You can use the transaction content and signature result to deduce the signer, that is, the address of the transaction sender. The combination of four parts solves the problem of transaction security, realizes the interactive mode of intelligent contracts and provides flexible and adjustable transaction handling fees.</p>
<h2 id="transaction-object-definition"><a name="transaction-object-definition" class="plugin-anchor" href="#transaction-object-definition"><i class="fa fa-link" aria-hidden="true"></i></a>Transaction object definition</h2>
<p>Specific to the code, <a href="https://www.simplechain.com/" target="_blank">SimpleChain</a> defines a transaction object as an externally accessible<code>Transation</code> objects and embedded objects that are invisible to external packages<code>txdata</code> .</p>
<blockquote>
<p>Lowercase <code>txdata</code> It is the feature of Go language. The initial letter is lowercase, which is equivalent to that in other programming languages. <code>private</code> Modifier, indicating that the data structure is invisible to external packets. The same lowercase object field (such as hash in Transaction) also indicates that the external package cannot access this field. Otherwise, the definition of uppercase type, field, method, etc. is regarded <code>public</code> .</p>
</blockquote>
<pre><code class="lang-go"><span class="hljs-comment">// core/types/transaction.go:38</span>
<span class="hljs-keyword">type</span> Transaction <span class="hljs-keyword">struct</span> {
    data txdata
    <span class="hljs-comment">// caches</span>
    hash atomic.Value
    size atomic.Value
    from atomic.Value
}

<span class="hljs-keyword">type</span> txdata <span class="hljs-keyword">struct</span> {
    AccountNonce <span class="hljs-keyword">uint64</span>     
    Price        *big.Int  
    GasLimit     <span class="hljs-keyword">uint64</span>     
    Recipient    *common.Address 
    Amount       *big.Int
    Payload      []<span class="hljs-keyword">byte</span>

    <span class="hljs-comment">// Signature values</span>
    V *big.Int
    R *big.Int
    S *big.Int

    <span class="hljs-comment">// This is only used when marshaling to JSON.</span>
    Hash *common.Hash <span class="hljs-string">`json:&quot;hash&quot; rlp:&quot;-&quot;`</span>
}
</code></pre>
<p>First look at the private <code>txdata</code> The structure defines the necessary content in the transaction message, which corresponds to the transaction data structure mentioned above in sequence. There are three points that need special attention.</p>
<ul>
<li><p>First, because hash operation is involved, the order of field definition cannot be adjusted at will, and fields must be defined as required under non-special processing conditions. So <code>txdata</code> The fields defined in conform to the content order of Simplechain transaction messages.</p>
</li>
<li><p>Second, when monetary calculation is involved, the problem of inaccurate calculation cannot be caused by lack of accuracy. Therefore, in all blockchain designs such as Simplechain and Bitcoin, the currency type is an integer, but the minimum value 1 The value of the currency represented is different. In<a href="https://www.simplechain.com/" target="_blank">SimpleChain</a>a sipc is equal to the 18th power Amount of 10. When 10 billion sipcs are to be represented, the Amount is equal to the 27th power of 10. It has far exceeded the range (0-18446744073709551615) that Uint64 can represent. Therefore<a href="https://www.simplechain.com/" target="_blank">SimpleChain</a>all use the large numbers provided by the Go standard package <code>big.Int</code> Perform currency operations and define currencies. Here <code>Price</code> And <code>Amount</code> Both are of the big.Int pointer type. In addition, the three values of the signature also use the big.Int type because the number is too large.</p>
</li>
<li><p>The third is the last <code>Hash</code> Field, which is not part of the transaction content, just to include the transaction hash in the transaction JSON. To prevent participation hash, the field is marked <code>rlp:&quot;-&quot;</code> . In addition, Transaction also defines three cache items: Transaction hash, Transaction size, and Transaction sender (from). The cache is used frequently and consumes a large amount of CPU.</p>
</li>
</ul>
<p>Hash operation is the most common operation in a blockchain. Data on all chains is basically involved in hash operation. However, hash operations are CPU intensive, so it is necessary to cache some hash operations to reduce CPU computing. After the transaction hash value is calculated for the first time, the transaction hash is cached on the hash field.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> (tx *Transaction) Hash() common.Hash {
   <span class="hljs-keyword">if</span> hash := tx.hash.Load(); hash != <span class="hljs-literal">nil</span> {
      <span class="hljs-keyword">return</span> hash.(common.Hash)
   }
   v := rlpHash(tx)
   tx.hash.Store(v)
   <span class="hljs-keyword">return</span> v
}
</code></pre>
<p>hash is <code>atomic.Value</code> Type, which is the atomic operation object provided by the Go standard package. This prevents concurrency from causing multiple hash calculations. First, the atom loads the hash value, and returns if it exists. If it does not exist, hash calculation is performed on the transaction (rlpHash, yes <a href="https://www.simplechain.com/" target="_blank">SimpleChain</a>)&#xFF0C;save the hash result and return it.</p>
<p>The second cache is the transaction size. Transaction size refers to the data size after RLP encoding of transaction information. Represents the network transmission size of the transaction, the block size of the transaction, and the storage size of the transaction. When each transaction enters the transaction pool, you must check whether the transaction size exceeds <code>32KB</code> . When pushing transaction data to other nodes, you must subcontract and push data when the transaction size does not exceed the maximum network message limit (default 10MB). To avoid repeated computing overhead, cache after the first computing.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> (tx *Transaction) Size() common.StorageSize {
   <span class="hljs-keyword">if</span> size := tx.size.Load(); size != <span class="hljs-literal">nil</span> {
      <span class="hljs-keyword">return</span> size.(common.StorageSize)
   }
   c := writeCounter(<span class="hljs-number">0</span>)
   rlp.Encode(&amp;c, &amp;tx.data)
   tx.size.Store(common.StorageSize(c))
   <span class="hljs-keyword">return</span> common.StorageSize(c)
}
</code></pre>
<p>As above, execute <code>rlp.Encode</code> Obtain the available data size, cache the result and return it.</p>
<blockquote>
<p>rlp is a set of blockchain data encoding and decoding protocols defined by Simplechain, instead of using common gzip, json, and Protobuf encoding formats. The purpose is to compress data as much as possible. After all, there are only several common data types in the blockchain data structure, which can meet the requirements without complicated protocols.</p>
</blockquote>
<p>The last cache item is the transaction sender (from). The sender of the transaction performs reverse computation based on the signature, which is also CPU-intensive. In order to ensure the legality of the transaction, the procedure involves taking the address of the transaction sender and verifying the legality of the sender everywhere. Only the correct signature can get the sender&apos;s address. Therefore, the transaction sender is also cached.</p>
<pre><code class="lang-go"><span class="hljs-comment">//core/types/transaction_signing.go:72</span>
<span class="hljs-keyword">func</span> Sender(signer Signer, tx *Transaction) (common.Address, error) {
   <span class="hljs-keyword">if</span> sc := tx.from.Load(); sc != <span class="hljs-literal">nil</span> {
      sigCache := sc.(sigCache) 
      <span class="hljs-keyword">if</span> sigCache.signer.Equal(signer) {
         <span class="hljs-keyword">return</span> sigCache.from, <span class="hljs-literal">nil</span>
      }
   }

   addr, err := signer.Sender(tx)
   <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
      <span class="hljs-keyword">return</span> common.Address{}, err
   }
   tx.from.Store(sigCache{signer: signer, from: addr})
   <span class="hljs-keyword">return</span> addr, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>A special point is needed <code>Signer</code> Unsign and pass <code>Signer</code> Obtains the Sender. If it is valid, it is cached and returned. However, when using the cached content, you also need to check whether the two signers are consistent, because different Signer algorithms are different, and the transaction signers obtained are also different.</p>
<p>Note that the above three cache usage have a precondition: Once a transaction object is created, the transaction content cannot be modified. This is also one of the reasons why the Transaction object is defined separately in the private txdata rather than directly defined in the Transaction. As shown in the following figure, only the transaction object method can be called to obtain the transaction content, and there is no way to modify the content of an existing transaction object.</p>
<p><img src="2.png" alt="&#x4EA4;&#x6613;&#x5BF9;&#x8C61;&#x65B9;&#x6CD5;&#x5217;&#x8868;"></p>
<h2 id="transaction-object-method-introduction"><a name="transaction-object-method-introduction" class="plugin-anchor" href="#transaction-object-method-introduction"><i class="fa fa-link" aria-hidden="true"></i></a>Transaction object method introduction</h2>
<p>In addition to providing external transaction content access, transaction object Transtion also defines some auxiliary methods. Let&apos;s introduce the methods in turn.</p>
<ol>
<li><p><code>ChainId()</code> and <code>Protected()</code></p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> (tx *Transaction) ChainId() *big.Int {
 <span class="hljs-keyword">return</span> deriveChainId(tx.data.V)
}
<span class="hljs-keyword">func</span> (tx *Transaction) Protected() <span class="hljs-keyword">bool</span> {
 <span class="hljs-keyword">return</span> isProtectedV(tx.data.V)
}
</code></pre>
</li>
</ol>
<p>From Transaction Signature content <code>V</code>Medium extraction <code>chain ID</code> . It is used to determine the validity of the signature when obtaining the transaction signer, once it is protected <code>Protected()</code> The signature information must contain the current chain ID, otherwise it is an illegal transaction.</p>
<ol>
<li><p>RLP interface implementation method</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> (tx *Transaction) EncodeRLP(w io.Writer) error {
   <span class="hljs-keyword">return</span> rlp.Encode(w, &amp;tx.data)
}
<span class="hljs-keyword">func</span> (tx *Transaction) DecodeRLP(s *rlp.Stream) error {
   _, size, _ := s.Kind()
   err := s.Decode(&amp;tx.data)
   <span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> {
      tx.size.Store(common.StorageSize(rlp.ListSize(size)))
   }
   <span class="hljs-keyword">return</span> err
}
</code></pre>
</li>
</ol>
<p>Unlike other object-oriented languages, an object is considered to belong to an interface type as long as it has all methods to implement an interface in Go language. Here, the Transaction implements <code>Encoder</code> And <code>Decoder</code> Two interfaces.</p>
<pre><code class="lang-go">  <span class="hljs-comment">//rlp/encode.go:36</span>
  <span class="hljs-keyword">type</span> Encoder <span class="hljs-keyword">interface</span> {
     EncodeRLP(io.Writer) error
  }
  <span class="hljs-keyword">type</span> Decoder <span class="hljs-keyword">interface</span> {
    DecodeRLP(*Stream) error
  }
</code></pre>
<p>This means that RLP encoding and decoding will be performed by two custom methods. RLP encoding decodes transactions. In fact, the transaction content txdata is encoded and decoded. At the same time, the transaction size is cached when the transaction is decoded.</p>
<ol>
<li><p>JJSON interface implementation</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> (tx *Transaction) MarshalJSON() ([]<span class="hljs-keyword">byte</span>, error) {
   hash := tx.Hash()
   data := tx.data
   data.Hash = &amp;hash
   <span class="hljs-keyword">return</span> data.MarshalJSON()
}
<span class="hljs-keyword">func</span> (tx *Transaction) UnmarshalJSON(input []<span class="hljs-keyword">byte</span>) error {
   <span class="hljs-keyword">var</span> dec txdata
   <span class="hljs-keyword">if</span> err := dec.UnmarshalJSON(input); err != <span class="hljs-literal">nil</span> {
      <span class="hljs-keyword">return</span> err
   }
   withSignature := dec.V.Sign() != <span class="hljs-number">0</span> || dec.R.Sign() != <span class="hljs-number">0</span> || dec.S.Sign() != <span class="hljs-number">0</span>
   <span class="hljs-keyword">if</span> withSignature {
      <span class="hljs-keyword">var</span> V <span class="hljs-keyword">byte</span>
      <span class="hljs-keyword">if</span> isProtectedV(dec.V) {
         chainID := deriveChainId(dec.V).Uint64()
         V = <span class="hljs-keyword">byte</span>(dec.V.Uint64() - <span class="hljs-number">35</span> - <span class="hljs-number">2</span>*chainID)
      } <span class="hljs-keyword">else</span> {
         V = <span class="hljs-keyword">byte</span>(dec.V.Uint64() - <span class="hljs-number">27</span>)
      }
      <span class="hljs-keyword">if</span> !crypto.ValidateSignatureValues(V, dec.R, dec.S, <span class="hljs-literal">false</span>) {
         <span class="hljs-keyword">return</span> ErrInvalidSig
      }
   }
   *tx = Transaction{data: dec}
   <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
</li>
</ol>
<p>This is a standard json package encoding and decoding method. It mainly returns JSON format data that meets the requirements when calling web3 APIs. The transaction hash is attached during encoding, and the validity of the signature format is also verified during decoding. The following is an example of complete transaction data in JSON format.</p>
<pre><code class="lang-json">   {
       <span class="hljs-string">&quot;nonce&quot;</span>: <span class="hljs-string">&quot;0x16&quot;</span>,
       <span class="hljs-string">&quot;gasPrice&quot;</span>: <span class="hljs-string">&quot;0x2&quot;</span>,
       <span class="hljs-string">&quot;gas&quot;</span>: <span class="hljs-string">&quot;0x1&quot;</span>,
       <span class="hljs-string">&quot;to&quot;</span>: <span class="hljs-string">&quot;0x0100000000000000000000000000000000000000&quot;</span>,
       <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;0x0&quot;</span>,
       <span class="hljs-string">&quot;input&quot;</span>: <span class="hljs-string">&quot;0x616263646566&quot;</span>,
       <span class="hljs-string">&quot;v&quot;</span>: <span class="hljs-string">&quot;0x25&quot;</span>,
       <span class="hljs-string">&quot;r&quot;</span>: <span class="hljs-string">&quot;0x3c46a1ff9d0dd2129a7f8fbc3e45256d85890d9d63919b42dac1eb8dfa443a32&quot;</span>,
       <span class="hljs-string">&quot;s&quot;</span>: <span class="hljs-string">&quot;0x6b2be3f225ae31f7ca18efc08fa403eb73b848359a63cd9fdeb61e1b83407690&quot;</span>,
       <span class="hljs-string">&quot;hash&quot;</span>: <span class="hljs-string">&quot;0xb848eb905affc383b4f431f8f9d3676733ea96bcae65638c0ada6e45038fb3a6&quot;</span>
   }
</code></pre>
<p><code>json</code> all numeric fields are expressed in hexadecimal numbers. This is to unify all data formats and serve large numbers of big.Int. The bignumber Library is specially built into the web3js library to process large numbers.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../7_account.html" class="navigation navigation-prev " aria-label="Previous page: Account">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../9_block/" class="navigation navigation-next " aria-label="Next page: Block">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Transaction","level":"4.4","depth":1,"next":{"title":"Block","level":"4.5","depth":1,"path":"9_block/README.md","ref":"9_block/README.md","articles":[]},"previous":{"title":"Account","level":"4.3","depth":1,"path":"7_account.md","ref":"7_account.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-lunr","-search","search-pro","language-picker","anchors"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"search-pro":{},"language-picker":{"grid-columns":3},"anchors":{},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Simplechain Documentation","language":"en","gitbook":"*"},"file":{"path":"8_transaction/README.md","mtime":"2020-08-06T06:29:44.329Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-08-06T10:07:28.339Z"},"basePath":"..","book":{"language":"en"}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-language-picker/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

