
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Write contract Â· Simplechain Documentation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-language-picker/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../30_frontRealize/" />
    
    
    <link rel="prev" href="../28_editor.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Quick Start</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../1_quickStart.html">
            
                <a href="../1_quickStart.html">
            
                    
                    Quick Start
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../2_BuildNode/">
            
                <a href="../2_BuildNode/">
            
                    
                    Build Node
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Sipc Coin Negotiate</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../47_techniqueLanguage.html">
            
                <a href="../47_techniqueLanguage.html">
            
                    
                    Technical Manual
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../3_sipcCoin.html">
            
                <a href="../3_sipcCoin.html">
            
                    
                    Sipc Coin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../4_PublishCoin/">
            
                <a href="../4_PublishCoin/">
            
                    
                    Publish Coin
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Basic Data Struct</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../5_concoct.html">
            
                <a href="../5_concoct.html">
            
                    
                    Deploy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../6_genesis/">
            
                <a href="../6_genesis/">
            
                    
                    Genesis Block
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../7_account.html">
            
                <a href="../7_account.html">
            
                    
                    Account
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="../8_transaction/">
            
                <a href="../8_transaction/">
            
                    
                    Transaction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="../9_block/">
            
                <a href="../9_block/">
            
                    
                    Block
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="../10_transactionReceipt/">
            
                <a href="../10_transactionReceipt/">
            
                    
                    Transaction Receipt
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Construct</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../11_constructDesign/">
            
                <a href="../11_constructDesign/">
            
                    
                    Structure Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../12_structAndStore/">
            
                <a href="../12_structAndStore/">
            
                    
                    Data Struct and 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../50_togetherStep.html">
            
                <a href="../50_togetherStep.html">
            
                    
                    Data Synchronize
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Underlying Core Technology</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../13_p2pNetwork.html">
            
                <a href="../13_p2pNetwork.html">
            
                    
                    p2p network
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="../14_consensus/">
            
                <a href="../14_consensus/">
            
                    
                    Consensus mechanism
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="../15_virtualMache/">
            
                <a href="../15_virtualMache/">
            
                    
                    virtual machine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="../16_runMechanism/">
            
                <a href="../16_runMechanism/">
            
                    
                    Operating mechanism
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="../17_unusual.html">
            
                <a href="../17_unusual.html">
            
                    
                    Handle exceptions
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Smart contract</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../18_contract/">
            
                <a href="../18_contract/">
            
                    
                    Smart contract
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="../19_understandSolidity/">
            
                <a href="../19_understandSolidity/">
            
                    
                    understand Solidity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="../20_contractPattern.html">
            
                <a href="../20_contractPattern.html">
            
                    
                    Contract template
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Developer tools</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../21_buildTest.html">
            
                <a href="../21_buildTest.html">
            
                    
                    Build Test network
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="../22_sipcApi.html">
            
                <a href="../22_sipcApi.html">
            
                    
                    Sip API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="../23_crossChainApi.html">
            
                <a href="../23_crossChainApi.html">
            
                    
                    Cross-chain API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="../24_chromeWallet/">
            
                <a href="../24_chromeWallet/">
            
                    
                    SimPlug
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="../25_sdk/">
            
                <a href="../25_sdk/">
            
                    
                    SDK
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Cross-chain</li>
        
        
    
        <li class="chapter " data-level="9.1" data-path="../48_crossChain/">
            
                <a href="../48_crossChain/">
            
                    
                    Cross-chain solution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="../26_smallChain.html">
            
                <a href="../26_smallChain.html">
            
                    
                    Subchain template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="../49_crossChainOrder/">
            
                <a href="../49_crossChainOrder/">
            
                    
                    Cross-chain process
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Dapp develop</li>
        
        
    
        <li class="chapter " data-level="10.1" data-path="../27_dappFlow/">
            
                <a href="../27_dappFlow/">
            
                    
                    Dapp process carding
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.2" data-path="../28_editor.html">
            
                <a href="../28_editor.html">
            
                    
                    translater
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="10.3" data-path="./">
            
                <a href="./">
            
                    
                    Write contract
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.4" data-path="../30_frontRealize/">
            
                <a href="../30_frontRealize/">
            
                    
                    Front-end development
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Mining</li>
        
        
    
        <li class="chapter " data-level="11.1" data-path="../31_mining.html">
            
                <a href="../31_mining.html">
            
                    
                    sipc mining
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.2" data-path="../32_miningPool/">
            
                <a href="../32_miningPool/">
            
                    
                    MinePool access
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.3" data-path="../33_gpuMining/">
            
                <a href="../33_gpuMining/">
            
                    
                    GPU Mining
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.4" data-path="../34_SimPool/">
            
                <a href="../34_SimPool/">
            
                    
                    Simpool Mining
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.5" data-path="../35_SimpleNode_x1/">
            
                <a href="../35_SimpleNode_x1/">
            
                    
                    SimpleNode x1 Mining
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Client</li>
        
        
    
        <li class="chapter " data-level="12.1" data-path="../36_SIPC.html">
            
                <a href="../36_SIPC.html">
            
                    
                    SIPC.VIP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.2" data-path="../37_wallet/">
            
                <a href="../37_wallet/">
            
                    
                    Sipc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.3" data-path="../38_ChainBox/">
            
                <a href="../38_ChainBox/">
            
                    
                    ChainBox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.4" data-path="../39_blockBrowser/">
            
                <a href="../39_blockBrowser/">
            
                    
                    Explore
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Ecology</li>
        
        
    
        <li class="chapter " data-level="13.1" data-path="../40_tradePlateform.html">
            
                <a href="../40_tradePlateform.html">
            
                    
                    Exchange docking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="13.2" data-path="../41_commityProduct.html">
            
                <a href="../41_commityProduct.html">
            
                    
                    Community Project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="13.3" data-path="../42_commityActity.html">
            
                <a href="../42_commityActity.html">
            
                    
                    Community Activity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="13.4" data-path="../43_commityEnters/">
            
                <a href="../43_commityEnters/">
            
                    
                    Community Entrance
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Landing scheme</li>
        
        
    
        <li class="chapter " data-level="14.1" data-path="../44_case.html">
            
                <a href="../44_case.html">
            
                    
                    Landing case
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Other</li>
        
        
    
        <li class="chapter " data-level="15.1" data-path="../45_faq.html">
            
                <a href="../45_faq.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="15.2" data-path="../46_supportOnline/">
            
                <a href="../46_supportOnline/">
            
                    
                    Online technical support
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Write contract</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="&#x4E00;-project-code-management"><a name="&#x4E00;-project-code-management" class="plugin-anchor" href="#&#x4E00;-project-code-management"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4E00;. Project code management</h2>
<p><a href="https://github.com/SimpleChainFans/funding.git" target="_blank">Project code base</a></p>
<h2 id="&#x4E8C;-single-crowdfunding-contract-implementation"><a name="&#x4E8C;-single-crowdfunding-contract-implementation" class="plugin-anchor" href="#&#x4E8C;-single-crowdfunding-contract-implementation"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4E8C;. Single crowdfunding contract implementation</h2>
<h3 id="1create-empty-contract-crowfunding"><a name="1create-empty-contract-crowfunding" class="plugin-anchor" href="#1create-empty-contract-crowfunding"><i class="fa fa-link" aria-hidden="true"></i></a>1.Create empty contract CrowFunding</h3>
<p>Enter the item catalog and create the file <code>basicFunding.sol</code></p>
<p><img src="1.png" alt="1.png"></p>
<p>And add the following code:</p>
<pre><code class="lang-go">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.24</span>;

contractCrowFunding    {

}
</code></pre>
<h3 id="2basic-attributes-state-variables"><a name="2basic-attributes-state-variables" class="plugin-anchor" href="#2basic-attributes-state-variables"><i class="fa fa-link" aria-hidden="true"></i></a>2.Basic attributes (state variables)</h3>
<table>
<thead>
<tr>
<th>State variable</th>
<th>Type</th>
<th>use</th>
</tr>
</thead>
<tbody>
<tr>
<td>creator</td>
<td>address</td>
<td>Project Initiation, responsible for contract creation, expense application, expense execution</td>
</tr>
<tr>
<td>projectName</td>
<td>string</td>
<td>Name of the crowdfunding item</td>
</tr>
<tr>
<td>supportBalance</td>
<td>uint</td>
<td>Crowdfunding holding amount</td>
</tr>
<tr>
<td>targetBalance</td>
<td>uint</td>
<td>Crowdfunding project bid raising amount</td>
</tr>
<tr>
<td>endTime</td>
<td>uint</td>
<td>Crowdfunding is cut off. If the amount of crowdfunding cannot be raised at this time, crowdfunding fails.</td>
</tr>
</tbody>
</table>
<h3 id="3constructor-implementation"><a name="3constructor-implementation" class="plugin-anchor" href="#3constructor-implementation"><i class="fa fa-link" aria-hidden="true"></i></a>3.Constructor implementation</h3>
<pre><code class="lang-go">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.24</span>;

contract CrowFunding {
   address public creator; <span class="hljs-comment">// &#x53D1;&#x8D77;&#x4EBA;</span>
   <span class="hljs-keyword">string</span> public projectName; <span class="hljs-comment">// &#x9879;&#x76EE;&#x540D;&#x79F0;</span>
   <span class="hljs-keyword">uint</span> public supportBalance; <span class="hljs-comment">// &#x53C2;&#x4E0E;&#x4F17;&#x7B79;&#x91D1;&#x989D;</span>
   <span class="hljs-keyword">uint</span> public targetBalance; <span class="hljs-comment">// &#x4F17;&#x7B79;&#x76EE;&#x6807;&#x91D1;&#x989D; </span>
   <span class="hljs-keyword">uint</span> public endTime; <span class="hljs-comment">// &#x4F17;&#x7B79;&#x622A;&#x6B62;&#x65F6;&#x95F4;</span>

constructor(<span class="hljs-keyword">string</span> _projectName, <span class="hljs-keyword">uint</span> _supportBalance, <span class="hljs-keyword">uint</span> _targetBalance, uin t _durationInSeconds) public {
   creator = msg.sender;
   projectName = _projectName;
   supportBalance = _supportBalance;
   targetBalance = _targetBalance; 
   <span class="hljs-comment">//&#x4F20;&#x9012;&#x8FDB;&#x6765;&#x5269;&#x4F59;&#x7684;&#x79D2;&#x6570;&#xFF0C;&#x6BD4;&#x5982;&#x82E5;&#x4F17;&#x7B79;30&#x5929;&#xFF0C;&#x5219;&#x4F20;&#x5165;&#xFF1A;30&#x5929; * 24&#x5C0F;&#x65F6; * 60&#x5206; * 60&#x79D2; = 2592000 </span>
   endTime = now + _durationInSeconds; <span class="hljs-comment">//2592000</span>
   } 
}
</code></pre>
<p><strong>Test</strong></p>
<p><img src="2.png" alt=""></p>
<h3 id="4participate-in-crowdfunding"><a name="4participate-in-crowdfunding" class="plugin-anchor" href="#4participate-in-crowdfunding"><i class="fa fa-link" aria-hidden="true"></i></a>4.Participate in crowdfunding</h3>
<p><strong>Implementation</strong></p>
<p>Add participant attributes</p>
<p> address[] public investors; //people who participate in crowdfunding, namely investors</p>
<p>Participating in crowdfunding means transferring money to the contract and adding the participants&apos; addresses to the collection. The code is as follows:</p>
<pre><code class="lang-go">function invest() public payable { 
   require(investorExistMap[msg.sender] == <span class="hljs-literal">false</span>);<span class="hljs-comment">//&#x6BCF;&#x4E2A;&#x4EBA;&#x53EA;&#x80FD;&#x53C2;&#x4E0E;&#x4E00;&#x6B21;</span>

   require(msg.value == supportBalance); <span class="hljs-comment">// &#x652F;&#x6301;&#x56FA;&#x5B9A;&#x91D1;&#x989D;</span>
   investors.push(msg.sender); <span class="hljs-comment">// &#x6DFB;&#x52A0;&#x5230;&#x4F17;&#x7B79;&#x4EBA;&#x6570;&#x7EC4;&#x4E2D;</span>
   investorExistMap[msg.sender] = <span class="hljs-literal">true</span>; <span class="hljs-comment">// &#x6807;&#x8BB0;&#x5F53;&#x524D;&#x8D26;&#x6237;&#x4E3A;&#x53C2;&#x4E0E;&#x4EBA;</span>
}
</code></pre>
<p>In order to quickly verify whether an account is in an array of participants, we provide a <code>mapping(address=&gt;bool)</code>to mark <code>mapping</code> the feature is that all keys exist by default, but the default value is<code>false</code>&#xFF0C;if it does not exist, return <code>false</code>,we use the user address <code>key</code>,set the value <code>true</code>,to complete the index, mapping is a linear index, than using for loop traversal <code>investors</code> arrays are efficient and economical, so you need to add the following attributes:</p>
<pre><code>mapping(address =&gt; bool) public investorExistMap; //&#x6807;&#x8BB0;&#x4E00;&#x4E2A;&#x4EBA;&#x662F;&#x5426;&#x53C2;&#x4E0E;&#x4E86;&#x5F53;&#x524D;&#x4F17;&#x7B79;
</code></pre><p><strong>test</strong></p>
<p>Test, please operate in digital order after deployment</p>
<p><img src="3.png" alt="3.png"></p>
<h3 id="refund-for-crowdfunding-failure-implementation"><a name="refund-for-crowdfunding-failure-implementation" class="plugin-anchor" href="#refund-for-crowdfunding-failure-implementation"><i class="fa fa-link" aria-hidden="true"></i></a>Refund for crowdfunding failure (implementation)</h3>
<p>Refund means that all the money raised will be returned to investors one by one. Two auxiliary functions are added at the same time to facilitate testing.</p>
<pre><code class="lang-go"><span class="hljs-comment">//&#x4F17;&#x7B79;&#x5931;&#x8D25;&#xFF0C;&#x9000;&#x6B3E;</span>
function drawBack() public {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">uint</span> i = <span class="hljs-number">0</span> ; i &lt; investors.length; i++) {
        investors[i].transfer(supportBalance);
}
<span class="hljs-comment">//&#x67E5;&#x770B;&#x5408;&#x7EA6;&#x5F53;&#x524D;&#x4F59;&#x989D;</span>
function getCurrentBalance() public view returns(<span class="hljs-keyword">uint</span>) {
    <span class="hljs-keyword">return</span> address(this).balance;
}
<span class="hljs-comment">//&#x8FD4;&#x56DE;&#x6240;&#x6709;&#x6295;&#x8D44;&#x4EBA;</span>
function getInvestors() public view returns(address[]) {
    <span class="hljs-keyword">return</span> investors;
}
</code></pre>
<p><strong>Test</strong></p>
<p><img src="4.png" alt="4.png"></p>
<h3 id="cost-request-implementation"><a name="cost-request-implementation" class="plugin-anchor" href="#cost-request-implementation"><i class="fa fa-link" aria-hidden="true"></i></a>Cost request (implementation)</h3>
<ul>
<li><p>Define structure
If crowdfunding is successful and the project is started, a fee needs to be pointed out, which needs to include the following information:</p>
</li>
<li><p>Purpose: What to buy?</p>
</li>
<li>Cost: How much does it cost?</li>
<li>Merchant address: from whom?</li>
<li>Number of votes approved at present: how many people approve, more than half of them approve the expenditure</li>
<li>Current status of this expense application: current status of this application: completed? To be approved? On behalf of the implementation?</li>
<li>Mark the set of people who have voted: mapping(address =&gt;bool), a mark set of people in favor, to prevent one person from voting for many times.</li>
</ul>
<p>Define the structure code based on the analysis:</p>
<pre><code class="lang-go"><span class="hljs-keyword">struct</span> Request {
   <span class="hljs-keyword">string</span> purpose; <span class="hljs-comment">//&#x4E70;&#x4EC0;&#x4E48;&#xFF1F;</span>
   <span class="hljs-keyword">uint</span> cost; <span class="hljs-comment">//&#x9700;&#x8981;&#x591A;&#x5C11;&#x94B1;&#xFF1F;</span>
   address shopAddress; <span class="hljs-comment">// &#x5411;&#x8C01;&#x8D2D;&#x4E70;&#xFF1F;</span>
   <span class="hljs-keyword">uint</span> voteCount; <span class="hljs-comment">// &#x591A;&#x5C11;&#x4EBA;&#x8D5E;&#x6210;&#x4E86;&#xFF0C;&#x8D85;&#x534A;&#x6570;&#x5219;&#x6279;&#x51C6;&#x652F;&#x51FA;</span>
   mapping(address =&gt; <span class="hljs-keyword">bool</span>) investorVotedMap; <span class="hljs-comment">//&#x8D5E;&#x6210;&#x4EBA;&#x7684;&#x6807;&#x8BB0;&#x96C6;&#x5408;&#xFF0C;&#x9632;&#x6B62;&#x4E00;&#x4EBA;&#x91CD;&#x590D;&#x6295;&#x7968;&#x591A;&#x6B21;</span>
   RequestStatus status; <span class="hljs-comment">//&#x8FD9;&#x4E2A;&#x7533;&#x8BF7;&#x7684;&#x5F53;&#x524D;&#x72B6;&#x6001;&#xFF1A;&#x6295;&#x7968;&#x4E2D;&#xFF1F;&#x5DF2;&#x6279;&#x51C6;&#xFF1F;&#x5DF2;&#x5B8C;&#x6210;&#xFF1F;</span>
}
</code></pre>
<p>Define an enumeration to describe the application status:</p>
<pre><code class="lang-go">enum RequestStatus {Voting,Approved,Completed}
</code></pre>
<ul>
<li>Definition method
This function is relatively simple. Create a new request structure and add it to the array.</li>
</ul>
<p>The code is as follows:</p>
<pre><code class="lang-go">Request[] public requests; <span class="hljs-comment">//&#x8BF7;&#x6C42;&#x53EF;&#x80FD;&#x6709;&#x591A;&#x4E2A;&#xFF0C;&#x6240;&#x4EE5;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;</span>
function createRequest(<span class="hljs-keyword">string</span> _purpose, <span class="hljs-keyword">uint</span> _cost, address _shopAddress) public {
       Request memory request = Request({
           purpose : _purpose,
           cost : _cost,
           shopAddress : _shopAddress,
           voteCount : <span class="hljs-number">0</span>,
           status : RequestStatus.Voting
       });
      requests.push(request); <span class="hljs-comment">//&#x5C06;&#x65B0;&#x7684;&#x8BF7;&#x6C42;&#x6DFB;&#x52A0;&#x81F3;&#x6570;&#x7EC4;&#x4E2D;</span>
}
</code></pre>
<p><strong>Test</strong></p>
<p>In <code>createRequest</code> add parameters in:</p>
<pre><code class="lang-json"><span class="hljs-string">&quot;&#x5C0F;&#x80D6;&#x5B50;&#x51CF;&#x80A5;&quot;</span>, <span class="hljs-number">100</span>, <span class="hljs-string">&quot;0xca35b7d915458ef540ade6068dfe2f44e8fa733c&quot;</span>
</code></pre>
<p>Search for the 0th request in the request, as shown in the following figure:</p>
<p><img src="5.png" alt="5.png"></p>
<h3 id="approval-of-payment-application"><a name="approval-of-payment-application" class="plugin-anchor" href="#approval-of-payment-application"><i class="fa fa-link" aria-hidden="true"></i></a>Approval of payment application</h3>
<p><strong>Implementation</strong></p>
<p>After the project Party initiates the application, it will be approved by the crowdfunding personnel, if the investors do not support it. Ignore it. The default value is false (not supported). If you want to support it, you need to perform an approval action. That is, modify the status of the data of the application structure, including:</p>
<ol>
<li>Check whether this person has voted. If not, vote is allowed. Otherwise, exit.</li>
<li>voteCount data plus 1.</li>
<li>Set the value of this voter&apos;s re-investorVotedMap mapping to true.</li>
</ol>
<p>The code is as follows:</p>
<pre><code class="lang-golang"><span class="hljs-comment">//&#x6279;&#x51C6;&#x2F40;&#x4ED8;&#x7533;&#x8BF7;</span>
function approveRequest(uint256 index) public {
    <span class="hljs-comment">// 1. &#x68C0;&#x9A8C;&#x8FD9;&#x4E2A;&#x2F08;&#x662F;&#x5426;&#x6295;&#x8FC7;&#x7968;&#xFF0C;&#x82E5;&#x672A;&#x6295;&#x8FC7;&#xFF0C;&#x5219;&#x5141;&#x8BB8;&#x6295;&#x7968;&#xFF0C;&#x53CD;&#x4E4B;&#x9000;&#x51FA;</span>
    <span class="hljs-comment">// 2. voteCount&#x6570;&#x636E;&#x52A0;1&#x3002;</span>
    <span class="hljs-comment">// 3. &#x5C06;&#x8BE5;&#x6295;&#x7968;&#x2F08;&#x5728;investorVotedMap&#x6620;&#x5C04;&#x4E2D;&#x7684;&#x503C;&#x8BBE;&#x7F6E;&#x4E3A;true&#x3002;</span>

    <span class="hljs-comment">//&#x2FB8;&#x5148;&#x8981;&#x786E;&#x4FDD;&#x662F;&#x53C2;&#x4E0E;&#x4F17;&#x7B79;&#x7684;&#x2F08;&#xFF0C;&#x5426;&#x5219;&#x2F46;&#x6743;&#x6295;&#x7968;</span>
    require(investExitMapping[msg.sender]);
    <span class="hljs-comment">//&#x6839;&#x636E;&#x7D22;&#x5F15;&#x627E;&#x5230;&#x7279;&#x5B9A;&#x7684;&#x8BF7;&#x6C42;</span>
    Request storage req = requests[index];
    <span class="hljs-comment">//&#x786E;&#x4FDD;&#x6CA1;&#x6709;&#x6295;&#x8FC7;&#x7968;&#xFF0C;&#x2F08;&#x2F3F;&#x2F00;&#x7968;</span>
    require(req.investorVotedMap[msg.sender] == <span class="hljs-literal">false</span>);
    <span class="hljs-comment">//&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#xFF0C;&#x6216;&#x8005;&#x5DF2;&#x7ECF;&#x83B7;&#x5F97;&#x6279;&#x51C6;&#x4E86;&#xFF0C;&#x5C31;&#x4E0D;&#x2F64;&#x6295;&#x7968;&#x4E86;&#xFF0C;&#x5F53;&#x524D;&#x6295;&#x7968;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x51B3;&#x7B56;&#x3002;</span>
    require(req.status == RequestStatus.Voting);

    <span class="hljs-comment">//&#x2F40;&#x6301;&#x7968;&#x6570;&#x52A0;1</span>
    req.voteCount += <span class="hljs-number">1</span>;
    <span class="hljs-comment">//&#x6807;&#x8BB0;&#x4E3A;&#x5DF2;&#x6295;&#x7968;</span>
    req.investorVotedMap[msg.sender] = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (req.voteCount * <span class="hljs-number">2</span> &gt; investors.length) {
        req.status == RequestStatus.Approved;
    }
}
</code></pre>
<p><strong>Test</strong></p>
<p>View the request after approval, and the voteCount becomes 1</p>
<p><img src="6.png" alt="6.png"></p>
<h3 id="complete-expense-request"><a name="complete-expense-request" class="plugin-anchor" href="#complete-expense-request"><i class="fa fa-link" aria-hidden="true"></i></a>Complete expense request</h3>
<p><strong>Implementation</strong></p>
<p>When more than half of the votes are voted, if the expenses are approved, the expenses can be executed by the project Party, or by the project Party, or by the contract automatically. We choose to execute it manually, because it is possible that the project Party changes and pays attention to it, and there is no need to purchase on the right side of the plan, so we transfer the rights to the project party.</p>
<p>This function mainly does two things:</p>
<p>1.If the number of votes exceeds half, the transfer will be executed.
2.Update the status of the request</p>
<p>Coding are as follows:</p>
<pre><code class="lang-golang">function finalizeRequest(uint256 index) public onlyManager{
    <span class="hljs-comment">// &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4E3B;&#x8981;&#x505A;&#x4E24;&#x4EF6;&#x4E8B;&#xFF1A;</span>
    <span class="hljs-comment">// 1. &#x7968;&#x6570;&#x8FC7;&#x534A;&#xFF0C;&#x5219;&#x6267;&#x2F8F;&#x8F6C;&#x8D26;&#x3002;</span>
    <span class="hljs-comment">// 2. &#x66F4;&#x65B0;request&#x7684;&#x72B6;&#x6001;&#x3002;</span>

    Request storage req = requests[index];
    <span class="hljs-comment">//&#x5408;&#x7EA6;&#x2FA6;&#x989D;&#x5145;&#x2F9C;&#x624D;&#x53EF;&#x4EE5;&#x6267;&#x2F8F;</span>
    require(address(this).balance &gt;= req.cost);
    <span class="hljs-comment">//&#x8D5E;&#x6210;&#x2F08;&#x6570;&#x8FC7;&#x534A;</span>
    require(req.voteCount * <span class="hljs-number">2</span> &gt; investors.length);
    <span class="hljs-comment">//&#x8F6C;&#x8D26;</span>
    req.shopAddress.transfer(req.cost);
    <span class="hljs-comment">//&#x66F4;&#x65B0;&#x8BF7;&#x6C42;&#x72B6;&#x6001;&#x4E3A;&#x5DF2;&#x5B8C;&#x6210;</span>
    req.status = RequestStatus.Completed;
}
</code></pre>
<p><strong>Test</strong></p>
<p>Three people invest, one is in favor, two are against, and the execution of payment fails.</p>
<p>!<img src="7.png" alt="7.png"></p>
<p>Two people agree, the execution of the payment is successful</p>
<p><img src="8.png" alt="8.png"></p>
<p>To fully implement smart contracts, several methods need to be implemented and the mutual calling of contract methods. These can be learned directly from the source code. But the contract writing and testing are now in the above several basic methods.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../28_editor.html" class="navigation navigation-prev " aria-label="Previous page: translater">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../30_frontRealize/" class="navigation navigation-next " aria-label="Next page: Front-end development">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Write contract","level":"10.3","depth":1,"next":{"title":"Front-end development","level":"10.4","depth":1,"path":"30_frontRealize/README.md","ref":"30_frontRealize/README.md","articles":[]},"previous":{"title":"translater","level":"10.2","depth":1,"path":"28_editor.md","ref":"28_editor.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-lunr","-search","search-pro","language-picker","anchors"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"search-pro":{},"language-picker":{"grid-columns":3},"anchors":{},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Simplechain Documentation","language":"en","gitbook":"*"},"file":{"path":"29_writeContract/README.md","mtime":"2020-08-06T06:29:44.214Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-08-06T10:07:28.339Z"},"basePath":"..","book":{"language":"en"}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-language-picker/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

